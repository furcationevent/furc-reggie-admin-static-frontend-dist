var ke=Object.defineProperty,xe=Object.defineProperties;var Ie=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var Oe=Object.prototype.hasOwnProperty,Ae=Object.prototype.propertyIsEnumerable;var de=(t,i,r)=>i in t?ke(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r,A=(t,i)=>{for(var r in i||(i={}))Oe.call(i,r)&&de(t,r,i[r]);if(ce)for(var r of ce(i))Ae.call(i,r)&&de(t,r,i[r]);return t},L=(t,i)=>xe(t,Ie(i));import{u as Ee,a as Ne,s as le,M as Pe,c as De,r as u,j as o,T as je,b as e,C as Ge,B as Le,d as Ke,I as ne,e as We,f as V,D as Me,g as Re,h as ze,i as He,L as Z,k as H,l as Fe,m as F,n as ue,o as re,p as qe,q as ye,t as Be,v as T,w as $e,x as Ue,y as Je,z as Ve,F as I,A as Y,P as Xe,S as D,E as S,G as W,H as M,J as N,K as Ye,N as Qe,O as R,Q as P,R as _,U as Ze,V as et,W as tt,X as B,Y as $,Z as ae,_ as Q,$ as nt,a0 as se,a1 as U,a2 as J,a3 as q,a4 as rt,a5 as be,a6 as at,a7 as ot,a8 as he,a9 as me,aa as it,ab as lt,ac as st,ad as ct,ae as dt,af as K}from"./vendor.5aebe429.js";const ut=function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))f(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const m of s.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&f(m)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function f(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}};ut();const G=()=>Ee(),ve=Ne,X=240,ht=le("main",{shouldForwardProp:t=>t!=="open"})(({theme:t,open:i})=>A({flexGrow:1,padding:t.spacing(3),transition:t.transitions.create("margin",{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen}),marginLeft:`-${X}px`},i&&{transition:t.transitions.create("margin",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.enteringScreen}),marginLeft:0})),mt=le(Pe,{shouldForwardProp:t=>t!=="open"})(({theme:t,open:i})=>A({transition:t.transitions.create(["margin","width"],{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen})},i&&{width:`calc(100% - ${X}px)`,marginLeft:`${X}px`,transition:t.transitions.create(["margin","width"],{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.enteringScreen})})),pe=le("div")(({theme:t})=>L(A({display:"flex",alignItems:"center",padding:t.spacing(0,1)},t.mixins.toolbar),{justifyContent:"flex-end"}));function pt(t){const i=G(),r=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,f=De({palette:{mode:r?"dark":"light"}}),[n,s]=u.exports.useState(!0),m=ve(b=>b.user.authed),p=()=>{s(!0)},w=()=>{s(!1)};let y;m?y={"/":{label:"Intro",icon:e(ue,{})},"/accommodation":{label:"Accommodation",icon:e(re,{})},"/attendees":{label:"Attendees",icon:e(qe,{})},"/groups":{label:"Groups",icon:e(ye,{})},"/config":{label:"Config",icon:e(Be,{})}}:y={"/":{label:"Intro",icon:e(ue,{})}};const h="/"+window.location.pathname.split("/")[1],[C,c]=u.exports.useState(y[h].label),k=b=>{const O=y[b];c(O.label),i(T(b))};return o(je,{theme:f,children:[e(Ge,{}),o(Le,{sx:{display:"flex"},children:[e(mt,{position:"fixed",open:n,children:o(Ke,{children:[e(ne,{color:"inherit","aria-label":"open drawer",onClick:p,edge:"start",sx:A({mr:2},n&&{display:"none"}),children:e(We,{})}),e(V,{variant:"h6",noWrap:!0,component:"div",children:C})]})}),o(Me,{sx:{width:X,flexShrink:0,"& .MuiDrawer-paper":{width:X,boxSizing:"border-box"}},variant:"persistent",anchor:"left",open:n,children:[e(pe,{children:e(ne,{onClick:w,children:f.direction==="ltr"?e(Re,{}):e(ze,{})})}),e(He,{}),e(Z,{children:Object.keys(y).map(b=>o(H,{button:!0,onClick:()=>k(b),children:[e(Fe,{children:y[b].icon}),e(F,{primary:y[b].label})]},b))})]}),o(ht,{open:n,children:[e(pe,{}),t.children]})]})]})}const gt={authed:!!localStorage.getItem("TOKEN")},we=$e({name:"user",initialState:gt,reducers:{login(t){t.authed=!0},logout(t){t.authed=!1}}}),{login:ft,logout:j}=we.actions;var Ct=we.reducer;const{createReduxHistory:yt,routerMiddleware:bt,routerReducer:vt}=Ue({history:Je()}),_e=Ve({reducer:{router:vt,user:Ct},middleware:[bt]}),wt=yt(_e),x=window.location.hostname=="localhost"?"http://localhost:8000/":"https://api.reg.furcation.org.uk/",_t=window.location.protocol+"//"+window.location.host;function St(){return fetch(x+"auth/o/keycloak/?"+new URLSearchParams({redirect_uri:_t}),{method:"GET",credentials:"include"})}function Tt(t,i){return fetch(x+"auth/o/keycloak/",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({state:t,code:i})})}function kt(){return fetch(x+"auth/users/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function xt(t){return fetch(x+"auth/users/"+t,{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function It(t){return fetch(x+"auth/users/"+t.id+"/",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify(t)})}function Ot(){return fetch(x+"accommodation/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function At(t){return fetch(x+"accommodation/"+t+"/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Et(t){return fetch(x+"accommodation/",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify(t)})}function Nt(t){return fetch(x+"accommodation/"+t.id+"/",{method:"DELETE",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Pt(t){return fetch(x+"accommodation/"+t.id+"/",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify(t)})}function Se(){return fetch(x+"groups/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function oe(t){return fetch(x+"groups/"+t+"/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Dt(t){return fetch(x+"groups/"+t.id+"/",{method:"DELETE",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function jt(t,i){return fetch(x+"groups/"+t.id+"/",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify({owner:{id:i,nickname:""}})})}function ie(t){return fetch(x+"groups/"+t.id+"/",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify(t)})}function Gt(){return fetch(x+"config/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Lt(t){return fetch(x+"config/"+t.id+"/",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify({value:t.value})})}function Kt(){const t=G(),i=ve(m=>m.user.authed),[r,f]=u.exports.useState("");return u.exports.useEffect(()=>{const m=new URLSearchParams(window.location.search),p=m.get("state"),w=m.get("code");!i&&p&&w&&Tt(p,w).then(y=>{y.status==201?y.json().then(h=>{localStorage.setItem("TOKEN",h.access),t(ft())}):y.json().then(h=>{f("Login flow expired, please login again."),console.log(h)})})},[]),o(I,{children:[r?e(Y,{severity:"error",children:r}):null,o(Xe,{variant:"outlined",sx:{my:{xs:3,md:6},p:{xs:2,md:3}},children:[e(V,{variant:"h6",color:"inherit",children:"Welcome to Furcation Registation Admin Panel"}),o(V,{variant:"body1",color:"inherit",paragraph:!0,children:["Welcome to the admin panel here you can view and edit attendees and groups for maintainance or resolving issues. For any issues please contact us:",e("br",{}),e("br",{}),"Registration - reg@furcation.org.uk",e("br",{}),"IT - it@furcation.org.uk"]}),i?e(D,{spacing:2,alignItems:"center",children:e(S,{color:"error",variant:"contained",sx:{minWidth:{sm:400,xs:"100%"}},onClick:()=>{t(j()),localStorage.removeItem("TOKEN")},children:"Logout"})}):e(D,{spacing:2,alignItems:"center",children:e(S,{variant:"contained",sx:{minWidth:{sm:400,xs:"100%"}},onClick:()=>{St().then(m=>{m.status==200?m.json().then(p=>{window.location.href=p.authorization_url}):m.json().then(p=>{f("Error while contacting Keycloak, please try again or contact tech."),console.log(p)})})},children:"Login with Keycloak"})})]})]})}function Wt(t){const i=G(),[r,f]=u.exports.useState([]),[n,s]=u.exports.useState("");u.exports.useEffect(()=>{Se().then(p=>{p.status==200?p.json().then(w=>{f(w.results.filter(y=>y.users.length<8)),s("0")}):p.status==401&&(i(T("/")),i(j()),localStorage.removeItem("TOKEN"))})},[]);const m=p=>{s(p.target.value)};return o(W,{open:t.open,onClose:()=>t.handleClose(null),children:[e(M,{children:"Pick a group"}),r?o(I,{children:[e(N,{children:e(Ye,{value:n,label:"Group",fullWidth:!0,variant:"standard",margin:"dense",onChange:m,children:r.map((p,w)=>o(Qe,{value:w,children:[p.owner.nickname,"'s Group"]},w))})}),o(R,{children:[e(S,{onClick:()=>t.handleClose(null),children:"Close"}),e(S,{onClick:()=>t.handleClose(r[parseInt(n)]),children:"Confirm"})]})]}):null]})}function Mt(t){const i=G(),[r,f]=u.exports.useState({}),[n,s]=u.exports.useState(null),[m,p]=u.exports.useState(null),[w,y]=u.exports.useState("1990-01-01"),[h,C]=u.exports.useState(0),[c,k]=u.exports.useState(!1);u.exports.useEffect(()=>{xt(t.userId).then(g=>{g.status==200?g.json().then(l=>{s(l),y(l.date_of_birth),l.group&&oe(l.group).then(v=>{v.status==200&&v.json().then(z=>{p(z)})})}):g.status==401?(i(T("/")),i(j()),localStorage.removeItem("TOKEN")):g.json().then(l=>{f(l),console.log(l)})})},[]);const b=g=>{n&&(n[g.target.name]=g.target.value,s(A({},n)))},O=g=>{n&&(n[g.target.name]=g.target.checked,s(A({},n)))},a=g=>{const l=new Date(g),v=l.getFullYear()+"-"+("0"+(l.getMonth()+1)).slice(-2)+"-"+("0"+l.getDate()).slice(-2);y(v),n&&(n.date_of_birth=v)},d=()=>{if(n){C(1);const g=A({},n);g.phone_number=E(g.phone_number),g.ice_phone=E(g.ice_phone),delete g.group,It(g).then(l=>{console.log(l.status),l.status==200?l.json().then(v=>{C(2),s(v),y(v.date_of_birth),v.group&&oe(v.group).then(z=>{z.status==200&&z.json().then(Te=>{p(Te)})})}):l.status==401?(i(T("/")),i(j()),localStorage.removeItem("TOKEN")):l.status==400&&(C(0),l.json().then(v=>{console.log(v),f(v)}))})}},E=g=>(g=g.replaceAll(" ",""),g.charAt(0)==="0"?"+44"+g.substring(1):g),ee=()=>{k(!0)},te=g=>{n&&g&&(g.users.push({id:n.id,nickname:n.nickname,fully_paid:!1}),ie(g).then(l=>{l.status==200&&(s(L(A({},n),{group:g})),p(g))})),k(!1)};return o(I,{children:[o(W,{open:t.open,onClose:t.handleClose,scroll:"body",children:[e(M,{children:"Attendee"}),n?o(I,{children:[o(N,{children:[o(P,{children:["Badge Number:"," ",n.badge_override?n.badge_override+" (Overridden from "+n.id+")":n.id]}),e(_,{required:!0,name:"full_name",label:"Full (Legal) Name",value:n.full_name,onChange:b,autoComplete:"fullname",error:Object.prototype.hasOwnProperty.call(r,"full_name"),helperText:r.full_name,fullWidth:!0,variant:"standard",margin:"dense"}),e(_,{required:!0,name:"nickname",label:"Badge Name (Nickname/Furry Name)",value:n.nickname,onChange:b,autoComplete:"nickname",error:Object.prototype.hasOwnProperty.call(r,"nickname"),helperText:r.nickname,fullWidth:!0,variant:"standard",margin:"dense"}),e(_,{required:!0,name:"email",label:"Email",value:n.email,onChange:b,autoComplete:"email",error:Object.prototype.hasOwnProperty.call(r,"email"),helperText:r.email,fullWidth:!0,variant:"standard",margin:"dense"}),e(Ze,{dateAdapter:et,children:e(tt,{label:"Date of Birth",value:w,onChange:a,inputFormat:"yyyy-MM-dd",mask:"____-__-__",renderInput:g=>e(_,L(A({},g),{required:!0,error:Object.prototype.hasOwnProperty.call(r,"date_of_birth"),helperText:r.date_of_birth,fullWidth:!0,variant:"standard",margin:"dense"}))})}),e(_,{required:!0,multiline:!0,rows:4,name:"address",label:"Address",value:n.address,onChange:b,error:Object.prototype.hasOwnProperty.call(r,"address"),helperText:r.address,fullWidth:!0,variant:"standard",margin:"dense"}),e(_,{required:!0,type:"tel",name:"phone_number",label:"Phone Number",autoComplete:"phone",value:n.phone_number,onChange:b,error:Object.prototype.hasOwnProperty.call(r,"phone_number"),helperText:r.phone_number,fullWidth:!0,variant:"standard",margin:"dense"}),e(_,{multiline:!0,rows:4,name:"medical_details",label:"Any medical details we should know? (optional)",value:n.medical_details||"",onChange:b,error:Object.prototype.hasOwnProperty.call(r,"medical_details"),helperText:r.medical_details,fullWidth:!0,variant:"standard",margin:"dense"}),e(_,{required:!0,name:"ice_name",label:"ICE Name",value:n.ice_name,onChange:b,autoComplete:"ice_name",error:Object.prototype.hasOwnProperty.call(r,"ice_name"),helperText:r.ice_name,fullWidth:!0,variant:"standard",margin:"dense"}),e(_,{required:!0,name:"ice_phone",label:"ICE Phone",value:n.ice_phone,onChange:b,autoComplete:"ice_phone",error:Object.prototype.hasOwnProperty.call(r,"ice_phone"),helperText:r.ice_phone,fullWidth:!0,variant:"standard",margin:"dense"}),e(B,{control:e($,{name:"is_fursuiter",checked:n.is_fursuiter,onChange:O}),label:"Fursuiter"}),e(B,{control:e($,{name:"is_early",checked:n.is_early,onChange:O}),label:"Early"}),e(B,{control:e($,{name:"is_late",checked:n.is_late,onChange:O}),label:"Late"}),e(B,{control:e($,{name:"is_sponsor",checked:n.is_sponsor,onChange:O}),label:"Sponsor"}),e(_,{name:"badge_override",label:"Badge Number Override",value:n.badge_override,onChange:b,autoComplete:"badge_override",error:Object.prototype.hasOwnProperty.call(r,"badge_override"),helperText:r.badge_override,fullWidth:!0,variant:"standard",margin:"dense"}),e(_,{name:"paid",label:"Amount paid",value:n.paid,onChange:b,autoComplete:"paid",type:"number",error:Object.prototype.hasOwnProperty.call(r,"paid"),InputProps:{endAdornment:e(ae,{position:"end",children:"p"})},helperText:r.paid,fullWidth:!0,variant:"standard",margin:"dense"}),e(_,{name:"adjustments",label:"Bill adjustments",value:n.adjustments,onChange:b,autoComplete:"adjustments",type:"number",error:Object.prototype.hasOwnProperty.call(r,"adjustments"),InputProps:{endAdornment:e(ae,{position:"end",children:"p"})},helperText:r.adjustments,fullWidth:!0,variant:"standard",margin:"dense"}),e(_,{multiline:!0,rows:4,name:"internal_notes",label:"Internal Notes",value:n.internal_notes||"",onChange:b,error:Object.prototype.hasOwnProperty.call(r,"internal_notes"),helperText:r.internal_notes,fullWidth:!0,variant:"standard",margin:"dense"})]}),e(N,{children:m?o(P,{children:["Group:"," ",o(Q,{to:"/groups/"+m.id,children:[m.owner.nickname,"'s Group"]})]}):o(P,{sx:{"& button":{m:1}},children:["No group",e(S,{size:"small",variant:"contained",color:"primary",onClick:ee,children:"Add to a group"})]})}),o(R,{children:[e(S,{onClick:t.handleClose,children:"Close"}),e(nt,{loading:h==1,color:h==2?"success":"primary",onClick:d,children:h==2?"Saved!":"Save Changes"})]})]}):null]}),c?e(Wt,{open:!0,handleClose:te}):null]})}function ge(){const t=G(),{id:i}=se(),[r,f]=u.exports.useState(""),[n,s]=u.exports.useState([]),[m,p]=u.exports.useState("");u.exports.useEffect(()=>{kt().then(c=>{c.status==200?c.json().then(k=>{s(k.results)}):c.status==401?(t(T("/")),t(j()),localStorage.removeItem("TOKEN")):c.json().then(k=>{f("Error while retrieving attendees.  Please try again or contact tech."),console.log(k)})})},[]);const w=c=>{t(T("/attendees/"+c.id))},y=()=>{t(T("/attendees"))},h=c=>{p(c.target.value)},C=c=>c.toLowerCase().includes(m.toLowerCase());return o(I,{children:[r?e(Y,{severity:"error",children:r}):null,e(_,{fullWidth:!0,id:"outlined-basic",label:"Search",variant:"outlined",onChange:h}),e(Z,{children:n.filter(c=>c.email?C(c.full_name)||C(c.nickname)||C(c.email)||C(c.id+"")||C(c.badge_override):!1).map((c,k)=>e(H,{children:o(U,{onClick:()=>w(c),children:[e(J,{children:c.badge_image?e(q,{src:"https://storage.googleapis.com/reggie-badges/"+c.badge_image}):e(q,{children:e(rt,{})})}),e(F,{primary:c.nickname,secondary:c.full_name+" - "+c.email+" - #"+(c.badge_override?c.badge_override+" (Overridden from "+c.id+")":c.id)})]})},k))}),i?e(Mt,{open:!0,handleClose:y,userId:i}):null]})}function Rt(t){const i=G(),[r,f]=u.exports.useState(null),[n,s]=u.exports.useState(0),[m,p]=u.exports.useState(!1),[w,y]=u.exports.useState(""),[h,C]=u.exports.useState(!1);u.exports.useEffect(()=>{oe(t.groupId).then(l=>{l.status==200?l.json().then(v=>{f(v),y(v.internal_notes)}):l.status==401&&(i(T("/")),i(j()),localStorage.removeItem("TOKEN"))})},[]);const c=l=>{s(l)},k=()=>{s(0)},b=()=>{r&&(r.users=r.users.filter(l=>l.id!==n),ie(r).then(l=>{l.status==200&&l.json().then(v=>{f(v),s(0)})}))},O=()=>{p(!0)},a=()=>{p(!1)},d=()=>{r&&Dt(r).then(l=>{l.status==204&&(t.handleDeleted(r),i(T("/groups")))})},E=l=>{r&&jt(r,l).then(v=>{v.json().then(z=>f(z))})},ee=l=>{r&&y(l.target.value)},te=()=>{r&&(r.internal_notes=w,ie(r).then(l=>{l.status==200&&l.json().then(v=>{C(!0),f(v),y(v.internal_notes)})}))},g=l=>{if(l.claimed_at){const v=new Date(l.claimed_at);return Math.round(Math.abs((v.getTime()-new Date().getTime())/864e5))}return 0};return o(I,{children:[o(W,{open:t.open,onClose:t.handleClose,scroll:"body",children:[e(M,{children:"Group"}),r?o(I,{children:[e(N,{children:o(P,{children:["Group ID: ",t.groupId]})}),e(N,{children:o(P,{sx:{"& button":{m:1}},children:["Owner:"," ",e(Q,{to:"/attendees/"+r.owner.id,children:r.owner.nickname+(r.owner.fully_paid?" (Paid)":" (Not paid)")}),e(S,{size:"small",variant:"contained",color:"error",onClick:O,children:"Disband Group"})]})}),r.users.filter(l=>l.id!==r.owner.id).map((l,v)=>e(N,{children:o(P,{sx:{"& button":{m:1}},children:[e(Q,{to:"/attendees/"+l.id,children:l.nickname+(l.fully_paid?" (Paid)":" (Not paid)")}),e(S,{size:"small",variant:"contained",color:"error",onClick:()=>c(l.id),children:"Remove from group"}),e(S,{size:"small",variant:"contained",color:"primary",onClick:()=>E(l.id),children:"Make group owner"})]})},v)),e(N,{children:o(D,{children:[e(_,{multiline:!0,rows:4,name:"internal_notes",label:"Internal Notes",value:w||"",onChange:ee,fullWidth:!0,variant:"standard",margin:"dense"}),e(S,{color:h?"success":"primary",onClick:te,children:h?"Saved!":"Save internal notes"})]})}),e(N,{children:r.accommodation?o(P,{children:["Accommodation:"," ",e(Q,{to:"/accommodation/"+r.accommodation.id,children:r.accommodation.name}),e("br",{}),"Claimed ",g(r)," days ago"]}):e(P,{children:"Group has no accommodation"})}),e(R,{children:e(S,{onClick:t.handleClose,children:"Close"})})]}):null]}),e(W,{open:!!n,onClose:k,children:r?o(I,{children:[e(M,{children:"Remove from group"}),e(N,{children:e(P,{children:"Are you sure?"})}),o(R,{children:[e(S,{onClick:k,children:"Close"}),e(S,{onClick:b,children:"Remove from group"})]})]}):null}),e(W,{open:m,onClose:a,children:r?o(I,{children:[e(M,{children:"Disband group"}),e(N,{children:e(P,{children:"Are you sure?"})}),o(R,{children:[e(S,{onClick:a,children:"Close"}),e(S,{onClick:d,children:"Disband group"})]})]}):null})]})}function fe(){const t=G(),{id:i}=se(),[r,f]=u.exports.useState(""),[n,s]=u.exports.useState([]),[m,p]=u.exports.useState("");u.exports.useEffect(()=>{Se().then(a=>{a.status==200?a.json().then(d=>{console.log(d),s(d.results)}):a.status==401?(t(T("/")),t(j()),localStorage.removeItem("TOKEN")):a.json().then(d=>{f("Error while retrieving groups.  Please try again or contact tech."),console.log(d)})})},[]);const w=a=>{t(T("/groups/"+a.id))},y=()=>{t(T("/groups"))},h=a=>{p(a.target.value)},C=a=>a.accommodation&&a.accommodation.name.toLowerCase().includes(m.toLowerCase())||a.owner.nickname.toLowerCase().includes(m.toLowerCase()),c=a=>{for(const d of a.users)if(!d.fully_paid)return!0;return!1},k=a=>{s(n.filter(d=>a.id!==d.id))},b=a=>{if(a.claimed_at){const d=new Date(a.claimed_at);return Math.round(Math.abs((d.getTime()-new Date().getTime())/864e5))}return 0},O=a=>a.accommodation?c(a)?" (Unpaid for "+b(a)+" days)":" (Paid)":"";return o(I,{children:[r?e(Y,{severity:"error",children:r}):null,e(_,{fullWidth:!0,id:"outlined-basic",label:"Search",variant:"outlined",onChange:h}),e(Z,{children:n.filter(a=>C(a)).map((a,d)=>e(H,{children:o(U,{onClick:()=>w(a),children:[e(J,{children:e(q,{children:e(ye,{})})}),e(F,{primary:a.owner.nickname+"'s group",secondary:a.users.length+" member(s)"+O(a)})]})},d))}),i?e(Rt,{open:!0,handleClose:y,groupId:i,handleDeleted:k}):null]})}function zt(){const t=G(),[i,r]=u.exports.useState(""),[f,n]=u.exports.useState([]),[s,m]=u.exports.useState(-1);u.exports.useEffect(()=>{Gt().then(h=>{h.status==200?h.json().then(C=>{n(C.results)}):h.status==401?(t(T("/")),t(j()),localStorage.removeItem("TOKEN")):h.json().then(C=>{r("Error while retrieving config.  Please try again or contact tech."),console.log(C)})})},[]);const p=h=>{f[parseInt(h.target.name)].value=h.target.value,n([...f])},w=h=>{Lt(f[h]).then(C=>{C.status==200?m(h):C.json().then(c=>{r("Error while retrieving config.  Please try again or contact tech."),console.log(c)})})},y={SIGNUP_MODE:"Current signup page restriction.  Set to 0 for signup closed, 1 for staff-only and 2 for signup open.",RECAPTCHA_MIN_SCORE:"Minimum required ReCAPTCHA assessment score, 0 is fail, 1 is success.  If in doubt, set to 0.3",INTRO_TEXT:"Message displayed on the registration site homepage.",CLAIM_MODE:"Current accommodation claim restriction.  Set to 0 for claim unavailable, 1 for staff-only and 2 for open to all.",SPONSOR_PRICE:"The price to sponsor in pence.",STAFF_DISCOUNT:"The discount staff receive in pence.",LODGE_EXTRA_DAYS:"The price in pence for extra days for lodges as JSON array of 8 prices.  Enter just null for no price.",EXTRA_DAYS:"The price in pence for extra days as JSON array of 8 prices.  Enter just null for no price."};return o(D,{direction:"column",spacing:2,children:[i?e(Y,{severity:"error",children:i}):null,f.map((h,C)=>o(D,{direction:"row",alignItems:"center",spacing:2,children:[e(V,{children:h.id}),e(_,{name:""+C,label:"Value",multiline:!0,maxRows:4,value:h.value,onChange:p}),e(V,{width:400,children:y[h.id]}),e(S,{variant:"contained",color:s==C?"success":"primary",onClick:()=>w(C),children:s==C?"Saved!":"Save"})]},C))]})}function Ht(t){const i=G(),[r,f]=u.exports.useState(!1),[n,s]=u.exports.useState(),m=be.createRef();u.exports.useEffect(()=>{t.isNew?s({id:crypto.randomUUID(),name:"",min_capacity:1,max_capacity:2,availability:0,prices:[null,null,null,null,null,null,null,null],is_lodge:!1,internal_notes:""}):At(t.accommodationId).then(a=>{a.status==200?a.json().then(d=>{s(d)}):a.status==401&&(i(T("/")),i(j()),localStorage.removeItem("TOKEN"))})},[]);const p=a=>{n&&s(L(A({},n),{[a.target.name]:a.target.value}))},w=a=>{if(n){const d=[...n.prices];for(let E=0;E<8;E++)(E+1<n.min_capacity||E+1>n.max_capacity)&&(d[E]=null);s(L(A({},n),{prices:d,[a.target.name]:a.target.value}))}},y=a=>{n&&s(L(A({},n),{[a.target.name]:a.target.checked}))},h=a=>{if(n){const d=parseInt(a.target.name.substring(a.target.name.indexOf("_")+1)),E=[...n.prices];E[d-1]=parseInt(a.target.value),s(L(A({},n),{prices:E}))}},C=()=>{f(!0)},c=()=>{f(!1)},k=()=>{n&&Nt(n).then(a=>{a.status==204&&(t.handleDeleted(n),i(T("/accommodation")))})},b=()=>{n&&m.current&&m.current.reportValidity()&&(t.isNew?Et(n):Pt(n)).then(d=>{(d.status==200||d.status==201)&&(t.handleUpdated(),i(T("/accommodation")))})},O=()=>{n&&n.id&&navigator.clipboard.writeText(n.id)};return o(I,{children:[o(W,{open:t.open,onClose:t.handleClose,scroll:"body",children:[o(D,{direction:"row",alignItems:"center",minWidth:"558px",children:[o(M,{children:[t.isNew?"Create ":null,"Accommodation"]}),n&&!t.isNew?o(P,{children:["ID: ",n.id,e(at,{title:"Copy",children:e(ne,{"aria-label":"copy",onClick:O,children:e(ot,{})})})]}):null]}),n?o(I,{children:[e(N,{children:o(D,{component:"form",ref:m,spacing:2,children:[e(_,{name:"name",onChange:p,label:"Accommodation Name",value:n.name,required:!0}),e(B,{control:e($,{name:"is_lodge",checked:n.is_lodge,onChange:y}),label:"Is lodge?"}),o(D,{direction:"row",spacing:2,alignItems:"center",justifyContent:"left",children:[e(_,{fullWidth:!0,required:!0,name:"min_capacity",onChange:w,label:"Minimum Occupancy",type:"number",inputProps:{inputMode:"numeric",pattern:"[0-9]*",min:1,max:8},value:n.min_capacity}),e(_,{fullWidth:!0,required:!0,name:"max_capacity",onChange:w,label:"Maximum Occupancy",type:"number",inputProps:{inputMode:"numeric",pattern:"[0-9]*",min:1,max:8},value:n.max_capacity}),e(_,{fullWidth:!0,required:!0,name:"availability",onChange:p,label:"Availability",type:"number",inputProps:{inputMode:"numeric",pattern:"[0-9]*"},value:n.availability})]}),e(D,{direction:"row",children:e(he,{container:!0,spacing:2,children:n.prices.map((a,d)=>d+1>=(n.min_capacity||1)&&d+1<=(n.max_capacity||8)&&d+1>=1&&d+1<=8?e(he,{item:!0,xs:6,children:e(_,{fullWidth:!0,required:!0,label:"Price for "+(d+1),name:"price_"+(d+1),value:a||"",onChange:h,type:"number",InputProps:{endAdornment:e(ae,{position:"end",children:"p"})}})},d):null)})}),e(_,{fullWidth:!0,name:"internal_notes",onChange:p,label:"Internal Notes",value:n.internal_notes,multiline:!0})]})}),o(R,{children:[t.isNew?e(I,{children:e(S,{onClick:b,children:"Create"})}):o(I,{children:[e(S,{onClick:b,children:"Save"}),e(S,{color:"error",onClick:C,children:"Delete"})]}),e(S,{onClick:t.handleClose,children:"Close"})]})]}):null]}),e(W,{open:r,onClose:c,children:n&&!t.isNew?o(I,{children:[e(M,{children:"Delete Accommodation"}),e(N,{children:e(P,{children:"Are you sure?"})}),o(R,{children:[e(S,{onClick:c,children:"Close"}),e(S,{onClick:k,children:"Delete"})]})]}):null})]})}function Ce(){const t=G(),{id:i}=se(),[r,f]=u.exports.useState(""),[n,s]=u.exports.useState([]),[m,p]=u.exports.useState("");u.exports.useEffect(()=>{w()},[]);const w=()=>{Ot().then(a=>{a.status==200?a.json().then(d=>{s(d.results)}):a.status==401?(t(T("/")),t(j()),localStorage.removeItem("TOKEN")):a.json().then(d=>{f("Error while retrieving groups.  Please try again or contact tech."),console.log(d)})})},y=a=>{t(T("/accommodation/"+a.id))},h=()=>{t(T("/accommodation/new"))},C=()=>{t(T("/accommodation"))},c=a=>{p(a.target.value)},k=a=>a.toLowerCase().includes(m.toLowerCase()),b=a=>{s(n.filter(d=>a.id!==d.id))},O=()=>{w()};return o(I,{children:[r?e(Y,{severity:"error",children:r}):null,e(_,{fullWidth:!0,id:"outlined-basic",label:"Search",variant:"outlined",onChange:c}),o(Z,{children:[e(H,{children:o(U,{onClick:()=>h(),children:[e(J,{children:e(q,{children:e(me,{})})}),e(F,{primary:"Create New"})]})}),n.filter(a=>k(a.name)).map((a,d)=>e(H,{children:o(U,{onClick:()=>y(a),children:[e(J,{children:e(q,{children:e(re,{})})}),e(F,{primary:a.name,secondary:o(D,{direction:"row",spacing:4,alignItems:"center",justifyContent:"left",children:[o(D,{direction:"row",spacing:1,alignItems:"center",children:[e(it,{}),o("span",{children:[a.min_capacity,"-",a.max_capacity]})]}),o(D,{direction:"row",spacing:1,alignItems:"center",children:[e(re,{}),e("span",{children:a.availability+" ("+(a.availability-a.occupied)+" remaining)"})]})]})})]})},d)),e(H,{children:o(U,{onClick:()=>h(),children:[e(J,{children:e(q,{children:e(me,{})})}),e(F,{primary:"Create New"})]})})]}),i?e(Ht,{open:!0,handleClose:C,accommodationId:i,handleDeleted:b,handleUpdated:O,isNew:i=="new"}):null]})}lt.render(e(be.StrictMode,{children:e(st,{store:_e,children:e(pt,{children:e(ct,{history:wt,children:o(dt,{children:[e(K,{path:"/",element:e(Kt,{})}),e(K,{path:"/accommodation",element:e(Ce,{})}),e(K,{path:"/accommodation/:id",element:e(Ce,{})}),e(K,{path:"/attendees",element:e(ge,{})}),e(K,{path:"/attendees/:id",element:e(ge,{})}),e(K,{path:"/groups",element:e(fe,{})}),e(K,{path:"/groups/:id",element:e(fe,{})}),e(K,{path:"/config",element:e(zt,{})})]})})})})}),document.getElementById("root"));

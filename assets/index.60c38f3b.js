var $e=Object.defineProperty,Je=Object.defineProperties;var qe=Object.getOwnPropertyDescriptors;var Te=Object.getOwnPropertySymbols;var Ye=Object.prototype.hasOwnProperty,Ve=Object.prototype.propertyIsEnumerable;var Oe=(t,r,a)=>r in t?$e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,I=(t,r)=>{for(var a in r||(r={}))Ye.call(r,a)&&Oe(t,a,r[a]);if(Te)for(var a of Te(r))Ve.call(r,a)&&Oe(t,a,r[a]);return t},q=(t,r)=>Je(t,qe(r));import{u as Xe,a as Ze,s as we,M as Qe,c as et,r as u,j as i,T as tt,b as e,C as nt,B as at,d as ot,I as de,e as rt,f as re,D as it,g as lt,h as ct,i as st,L as fe,k as ne,l as dt,m as ae,n as Ie,o as be,p as ut,q as Ge,t as ht,v as A,w as Re,x as mt,y as pt,z as gt,F as E,A as he,P as ft,S as K,E as v,G as U,H as $,J as N,K as F,N as W,O as J,Q as j,R as S,U as Ct,V as yt,W as _t,X as ee,Y as te,Z as z,_ as xe,$ as ge,a0 as vt,a1 as ke,a2 as B,a3 as Fe,a4 as ce,a5 as se,a6 as oe,a7 as bt,a8 as We,a9 as xt,aa as St,ab as Ee,ac as Ne,ad as wt,ae as kt,af as At,ag as Tt,ah as Ot,ai as V}from"./vendor.3962a6c3.js";const It=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))p(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const m of c.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&p(m)}).observe(document,{childList:!0,subtree:!0});function a(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerpolicy&&(c.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?c.credentials="include":n.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function p(n){if(n.ep)return;n.ep=!0;const c=a(n);fetch(n.href,c)}};It();const H=()=>Xe(),Q=Ze,ue=240,Et=we("main",{shouldForwardProp:t=>t!=="open"})(({theme:t,open:r})=>I({flexGrow:1,padding:t.spacing(3),transition:t.transitions.create("margin",{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen}),marginLeft:`-${ue}px`},r&&{transition:t.transitions.create("margin",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.enteringScreen}),marginLeft:0})),Nt=we(Qe,{shouldForwardProp:t=>t!=="open"})(({theme:t,open:r})=>I({transition:t.transitions.create(["margin","width"],{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen})},r&&{width:`calc(100% - ${ue}px)`,marginLeft:`${ue}px`,transition:t.transitions.create(["margin","width"],{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.enteringScreen})})),De=we("div")(({theme:t})=>q(I({display:"flex",alignItems:"center",padding:t.spacing(0,1)},t.mixins.toolbar),{justifyContent:"flex-end"}));function Dt(t){const r=H(),a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,p=et({palette:{mode:a?"dark":"light"}}),[n,c]=u.exports.useState(!0),m=Q(k=>k.user.authed),h=()=>{c(!0)},_=()=>{c(!1)};let g;m?g={"/":{label:"Intro",icon:e(Ie,{})},"/accommodation":{label:"Accommodation",icon:e(be,{})},"/attendees":{label:"Attendees",icon:e(ut,{})},"/groups":{label:"Groups",icon:e(Ge,{})},"/config":{label:"Config",icon:e(ht,{})}}:g={"/":{label:"Intro",icon:e(Ie,{})}};const y="/"+window.location.pathname.split("/")[1],[b,D]=u.exports.useState(g[y].label),L=k=>{const G=g[k];D(G.label),r(A(k))};return i(tt,{theme:p,children:[e(nt,{}),i(at,{sx:{display:"flex"},children:[e(Nt,{position:"fixed",open:n,children:i(ot,{children:[e(de,{color:"inherit","aria-label":"open drawer",onClick:h,edge:"start",sx:I({mr:2},n&&{display:"none"}),children:e(rt,{})}),e(re,{variant:"h6",noWrap:!0,component:"div",children:b})]})}),i(it,{sx:{width:ue,flexShrink:0,"& .MuiDrawer-paper":{width:ue,boxSizing:"border-box"}},variant:"persistent",anchor:"left",open:n,children:[e(De,{children:e(de,{onClick:_,children:p.direction==="ltr"?e(lt,{}):e(ct,{})})}),e(st,{}),e(fe,{children:Object.keys(g).map(k=>i(ne,{button:!0,onClick:()=>L(k),children:[e(dt,{children:g[k].icon}),e(ae,{primary:g[k].label})]},k))})]}),i(Et,{open:n,children:[e(De,{}),t.children]})]})]})}const Pt={authed:!!localStorage.getItem("TOKEN")},Ke=Re({name:"user",initialState:Pt,reducers:{login(t){t.authed=!0},logout(t){t.authed=!1}}}),{login:jt,logout:M}=Ke.actions;var Lt=Ke.reducer;const Gt={config:{}},ze=Re({name:"config",initialState:Gt,reducers:{setConfig(t,r){t.config=r.payload}}}),{setConfig:Rt}=ze.actions;var Ft=ze.reducer;const{createReduxHistory:Wt,routerMiddleware:Kt,routerReducer:zt}=mt({history:pt()}),Ae=gt({reducer:{router:zt,user:Lt,config:Ft},middleware:[Kt]}),Mt=Wt(Ae),T=window.location.hostname=="localhost"?"http://localhost:8000/":"https://api.reg.furcation.org.uk/",Ht=window.location.protocol+"//"+window.location.host;function Bt(){return fetch(T+"auth/o/keycloak/?"+new URLSearchParams({redirect_uri:Ht}),{method:"GET",credentials:"include"})}function Ut(t,r){return fetch(T+"auth/o/keycloak/",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({state:t,code:r})})}function $t(){return fetch(T+"auth/users/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Jt(t){return fetch(T+"auth/users/"+t,{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function qt(t){return fetch(T+"auth/users/"+t.id+"/",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify(t)})}function Me(){return fetch(T+"accommodation/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Yt(t){return fetch(T+"accommodation/"+t+"/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Vt(t){return fetch(T+"accommodation/",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify(t)})}function Xt(t){return fetch(T+"accommodation/"+t.id+"/",{method:"DELETE",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Zt(t){return fetch(T+"accommodation/"+t.id+"/",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify(t)})}function He(){return fetch(T+"groups/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Se(t){return fetch(T+"groups/"+t+"/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Qt(t){return fetch(T+"groups/"+t.id+"/",{method:"DELETE",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function en(t){return fetch(T+"auth/users/"+t.id+"/",{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")}})}function tn(t,r){return fetch(T+"groups/"+t.id+"/",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify({owner:{id:r,nickname:""}})})}function le(t){return fetch(T+"groups/"+t.id+"/",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify(t)})}function Be(){return fetch(T+"config/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function nn(t){return fetch(T+"config/"+t.id+"/",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify({value:t.value})})}function an(){const t=H(),r=Q(m=>m.user.authed),[a,p]=u.exports.useState("");return u.exports.useEffect(()=>{const m=new URLSearchParams(window.location.search),h=m.get("state"),_=m.get("code");!r&&h&&_&&Ut(h,_).then(g=>{g.status==201?g.json().then(y=>{localStorage.setItem("TOKEN",y.access),t(jt())}):g.json().then(y=>{p("Login flow expired, please login again."),console.log(y)})})},[]),i(E,{children:[a?e(he,{severity:"error",children:a}):null,i(ft,{variant:"outlined",sx:{my:{xs:3,md:6},p:{xs:2,md:3}},children:[e(re,{variant:"h6",color:"inherit",children:"Welcome to Furcation Registation Admin Panel"}),i(re,{variant:"body1",color:"inherit",paragraph:!0,children:["Welcome to the admin panel here you can view and edit attendees and groups for maintainance or resolving issues. For any issues please contact us:",e("br",{}),e("br",{}),"Registration - reg@furcation.org.uk",e("br",{}),"IT - it@furcation.org.uk"]}),r?e(K,{spacing:2,alignItems:"center",children:e(v,{color:"error",variant:"contained",sx:{minWidth:{sm:400,xs:"100%"}},onClick:()=>{t(M()),localStorage.removeItem("TOKEN")},children:"Logout"})}):e(K,{spacing:2,alignItems:"center",children:e(v,{variant:"contained",sx:{minWidth:{sm:400,xs:"100%"}},onClick:()=>{Bt().then(m=>{m.status==200?m.json().then(h=>{window.location.href=h.authorization_url}):m.json().then(h=>{p("Error while contacting Keycloak, please try again or contact tech."),console.log(h)})})},children:"Login with Keycloak"})})]})]})}function on(t){const r=H(),[a,p]=u.exports.useState([]),[n,c]=u.exports.useState("");u.exports.useEffect(()=>{He().then(h=>{h.status==200?h.json().then(_=>{p(_.results.filter(g=>g.users.length<8)),c("0")}):h.status==401&&(r(A("/")),r(M()),localStorage.removeItem("TOKEN"))})},[]);const m=h=>{c(h.target.value)};return i(U,{open:t.open,onClose:()=>t.handleClose(null),children:[e($,{children:"Pick a group"}),a?i(E,{children:[e(N,{children:e(F,{value:n,label:"Group",fullWidth:!0,variant:"standard",margin:"dense",onChange:m,children:a.map((h,_)=>i(W,{value:_,children:[h.owner.nickname,"'s Group"]},_))})}),i(J,{children:[e(v,{onClick:()=>t.handleClose(null),children:"Close"}),e(v,{onClick:()=>t.handleClose(a[parseInt(n)]),children:"Confirm"})]})]}):null]})}function rn(t){const r=H(),[a,p]=u.exports.useState({}),[n,c]=u.exports.useState(null),[m,h]=u.exports.useState(null),[_,g]=u.exports.useState("1990-01-01"),[y,b]=u.exports.useState(0),[D,L]=u.exports.useState(!1),[k,G]=u.exports.useState(!1);u.exports.useEffect(()=>{Jt(t.userId).then(l=>{l.status==200?l.json().then(x=>{c(x),g(x.date_of_birth),x.group&&Se(x.group).then(P=>{P.status==200&&P.json().then(Z=>{h(Z)})})}):l.status==401?(r(A("/")),r(M()),localStorage.removeItem("TOKEN")):l.json().then(x=>{p(x)})})},[]);const d=JSON.parse(Q(l=>l.config.config.HOODIE_SIZES||"[]")),f=JSON.parse(Q(l=>l.config.config.EXTRA_DAYS||"[]")),w=JSON.parse(Q(l=>l.config.config.LODGE_EXTRA_DAYS||"[]")),Y=JSON.parse(Q(l=>l.config.config.SPONSOR_PRICE||"[]")),o=JSON.parse(Q(l=>l.config.config.STAFF_DISCOUNT||"[]")),R=()=>{let l=0;if(n&&m&&m.accommodation){l=m.accommodation.prices[m.users.length-1]||0;const x=m.accommodation.is_lodge?w:f;n.email.endsWith("@furcation.org.uk")&&(l-=o);let P=0,Z=0;m.users.map(pe=>{pe.is_early&&(P+=1),pe.is_late&&(Z+=1)}),n.is_early&&(l+=x[P-1]),n.is_late&&(l+=x[Z-1]),n.is_sponsor&&(l+=Y),l+=Number(n.adjustments)}return l},s=l=>{n&&(n[l.target.name]=l.target.value,c(I({},n)))},O=()=>{G(!0)},Ce=()=>{n&&en(n).then(l=>{l.status==204&&(t.handleDeleted(n),t.handleClose())})},X=l=>{n&&(n[l.target.name]=l.target.checked,c(I({},n)))},ye=l=>{n&&(n.hoodie_size=l.target.value,c(I({},n)))},ie=l=>{const x=new Date(l),P=x.getFullYear()+"-"+("0"+(x.getMonth()+1)).slice(-2)+"-"+("0"+x.getDate()).slice(-2);g(P),n&&(n.date_of_birth=P)},_e=()=>{if(n){b(1);const l=I({},n);l.phone_number=me(l.phone_number),l.ice_phone=me(l.ice_phone),delete l.group,qt(l).then(x=>{console.log(x.status),x.status==200?x.json().then(P=>{b(2),c(P),g(P.date_of_birth),P.group&&Se(P.group).then(Z=>{Z.status==200&&Z.json().then(pe=>{h(pe)})})}):x.status==401?(r(A("/")),r(M()),localStorage.removeItem("TOKEN")):x.status==400&&(b(0),x.json().then(P=>{console.log(P),p(P)}))})}},me=l=>(l=l.replaceAll(" ",""),l.charAt(0)==="0"?"+44"+l.substring(1):l),ve=()=>{L(!0)},C=l=>{n&&l&&(l.users.push({id:n.id,nickname:n.nickname,fully_paid:!1,is_early:!1,is_late:!1}),le(l).then(x=>{x.status==200&&(c(q(I({},n),{group:l})),h(l))})),L(!1)};return i(E,{children:[i(U,{open:t.open,onClose:t.handleClose,scroll:"body",children:[e($,{children:"Attendee "}),n?i(E,{children:[i(N,{children:[i(j,{children:["Badge Number:"," ",n.badge_override?n.badge_override+" (Overridden from "+n.id+")":n.id]}),e(S,{required:!0,name:"full_name",label:"Full (Legal) Name",value:n.full_name,onChange:s,autoComplete:"fullname",error:Object.prototype.hasOwnProperty.call(a,"full_name"),helperText:a.full_name,fullWidth:!0,variant:"standard",margin:"dense"}),e(S,{required:!0,name:"nickname",label:"Badge Name (Nickname/Furry Name)",value:n.nickname,onChange:s,autoComplete:"nickname",error:Object.prototype.hasOwnProperty.call(a,"nickname"),helperText:a.nickname,fullWidth:!0,variant:"standard",margin:"dense"}),e(S,{required:!0,name:"email",label:"Email",value:n.email,onChange:s,autoComplete:"email",error:Object.prototype.hasOwnProperty.call(a,"email"),helperText:a.email,fullWidth:!0,variant:"standard",margin:"dense"}),e(Ct,{dateAdapter:yt,children:e(_t,{label:"Date of Birth",value:_,onChange:ie,inputFormat:"yyyy-MM-dd",mask:"____-__-__",renderInput:l=>e(S,q(I({},l),{required:!0,error:Object.prototype.hasOwnProperty.call(a,"date_of_birth"),helperText:a.date_of_birth,fullWidth:!0,variant:"standard",margin:"dense"}))})}),e(S,{required:!0,multiline:!0,rows:4,name:"address",label:"Address",value:n.address,onChange:s,error:Object.prototype.hasOwnProperty.call(a,"address"),helperText:a.address,fullWidth:!0,variant:"standard",margin:"dense"}),e(S,{required:!0,type:"tel",name:"phone_number",label:"Phone Number",autoComplete:"phone",value:n.phone_number,onChange:s,error:Object.prototype.hasOwnProperty.call(a,"phone_number"),helperText:a.phone_number,fullWidth:!0,variant:"standard",margin:"dense"}),e(S,{multiline:!0,rows:4,name:"medical_details",label:"Any medical details we should know? (optional)",value:n.medical_details||"",onChange:s,error:Object.prototype.hasOwnProperty.call(a,"medical_details"),helperText:a.medical_details,fullWidth:!0,variant:"standard",margin:"dense"}),e(S,{required:!0,name:"ice_name",label:"ICE Name",value:n.ice_name,onChange:s,autoComplete:"ice_name",error:Object.prototype.hasOwnProperty.call(a,"ice_name"),helperText:a.ice_name,fullWidth:!0,variant:"standard",margin:"dense"}),e(S,{required:!0,name:"ice_phone",label:"ICE Phone",value:n.ice_phone,onChange:s,autoComplete:"ice_phone",error:Object.prototype.hasOwnProperty.call(a,"ice_phone"),helperText:a.ice_phone,fullWidth:!0,variant:"standard",margin:"dense"}),e(ee,{control:e(te,{name:"is_fursuiter",checked:n.is_fursuiter,onChange:X}),label:"Fursuiter"}),e(ee,{control:e(te,{name:"is_early",checked:n.is_early,onChange:X}),label:"Early"}),e(ee,{control:e(te,{name:"is_late",checked:n.is_late,onChange:X}),label:"Late"}),e(ee,{control:e(te,{name:"is_sponsor",checked:n.is_sponsor,onChange:X}),label:"Sponsor"}),e(z,{shrink:!0,children:"Hoodie Size"}),e(F,{value:n.hoodie_size,fullWidth:!0,variant:"standard",margin:"dense",label:"Hoodie Size",onChange:ye,children:d.map(l=>e(W,{value:l,children:e(re,{color:"text.primary",children:l})},l))}),e(S,{name:"badge_override",label:"Badge Number Override",value:n.badge_override,onChange:s,autoComplete:"badge_override",error:Object.prototype.hasOwnProperty.call(a,"badge_override"),helperText:a.badge_override,fullWidth:!0,variant:"standard",margin:"dense"}),e(S,{name:"paid",label:"Amount paid",value:n.paid,onChange:s,autoComplete:"paid",type:"number",error:Object.prototype.hasOwnProperty.call(a,"paid"),InputProps:{endAdornment:e(xe,{position:"end",children:"p"})},helperText:a.paid,fullWidth:!0,variant:"standard",margin:"dense"}),e(S,{name:"adjustments",label:"Bill adjustments",value:n.adjustments,onChange:s,autoComplete:"adjustments",type:"number",error:Object.prototype.hasOwnProperty.call(a,"adjustments"),InputProps:{endAdornment:e(xe,{position:"end",children:"p"})},helperText:a.adjustments,fullWidth:!0,variant:"standard",margin:"dense"})]}),e(N,{children:i(j,{children:["Total Bill: \xA3",(R()/100).toFixed(2)]})}),e(N,{children:i(j,{children:["Left to pay: \xA3",((R()-n.paid)/100).toFixed(2)]})}),e(N,{children:e(S,{multiline:!0,rows:4,name:"internal_notes",label:"Internal Notes",value:n.internal_notes||"",onChange:s,error:Object.prototype.hasOwnProperty.call(a,"internal_notes"),helperText:a.internal_notes,fullWidth:!0,variant:"standard",margin:"dense"})}),i(N,{children:[m?i(j,{children:["Group:"," ",i(ge,{to:"/groups/"+m.id,children:[m.owner.nickname,"'s Group"]})]}):i(j,{sx:{"& button":{m:1}},children:["No group",e(v,{size:"small",variant:"contained",color:"primary",onClick:ve,children:"Add to a group"})]}),e(ee,{control:e(te,{name:"checked_in",checked:n.checked_in,onChange:X}),label:"Checked In"})]}),i(J,{children:[e(v,{onClick:t.handleClose,children:"Close"}),e(v,{color:"error",onClick:O,children:"Delete"}),e(vt,{loading:y==1,color:y==2?"success":"primary",onClick:_e,children:y==2?"Saved!":"Save Changes"})]})]}):null]}),D?e(on,{open:!0,handleClose:C}):null,i(U,{open:k,onClose:t.handleClose,children:[e($,{children:"Delete Attendee"}),e(N,{children:e(j,{children:"Are you sure you want to delete this attendee?"})}),i(J,{children:[e(v,{onClick:t.handleClose,children:"Cancel"}),e(v,{onClick:Ce,color:"error",variant:"contained",children:"Delete"})]})]})]})}function Ue(t){const r=u.exports.createRef();return e(E,{children:e("a",{role:"button",ref:r,onClick:async()=>{if(r&&r.current&&r.current.href)return;const n=await(await fetch(t.url,{headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})).blob(),c=window.URL.createObjectURL(n);r&&r.current&&(r.current.download=t.filename,r.current.href=c,r.current.click())},children:t.children})})}function Pe(){const t=H(),r=["Not Filtered","Yes","No"],{id:a}=ke(),[p,n]=u.exports.useState(""),[c,m]=u.exports.useState({is_early:"Not Filtered",is_late:"Not Filtered",is_sponsor:"Not Filtered",is_active:"Yes",is_staff:"Not Filtered",is_admin:"No",has_accommodation:"Yes",checked_in:"Not Filtered"}),[h,_]=u.exports.useState([]),[g,y]=u.exports.useState("");u.exports.useEffect(()=>{b()},[]);const b=()=>{$t().then(o=>{o.status==200?o.json().then(R=>{_(R.results)}):o.status==401?(t(A("/")),t(M()),localStorage.removeItem("TOKEN")):o.json().then(()=>{n("Error while retrieving attendees.  Please try again or contact tech.")})})},D=o=>{_(h.filter(()=>o.id!==o.id))},L=o=>{t(A("/attendees/"+o.id))},k=()=>{t(A("/attendees")),b()},G=o=>{y(o.target.value)},d=o=>{console.log(o.target.name+": "+o.target.value),c[o.target.name]=o.target.value,m(I({},c))},f=o=>o.toLowerCase().includes(g.toLowerCase()),w=(o,R)=>o==r[0]?!0:o==r[1]?R:!R,Y=o=>w(c.is_early,o.is_early)&&w(c.is_late,o.is_late)&&w(c.is_sponsor,o.is_sponsor)&&w(c.is_staff,o.email.endsWith("@furcation.org.uk"))&&w(c.is_active,o.is_active)&&w(c.is_admin,o.is_staff)&&w(c.checked_in,o.checked_in)&&w(c.has_accommodation,o.has_accommodation);return i(E,{children:[p?e(he,{severity:"error",children:p}):null,e(S,{fullWidth:!0,id:"outlined-basic",label:"Search",variant:"outlined",onChange:G}),i(B,{sx:{width:"20ch",p:{xs:2,md:3}},children:[e(z,{sx:{p:{xs:3,md:4}},children:"Early"}),e(F,{value:c.is_early,label:"Early",name:"is_early",onChange:d,children:r.map(o=>e(W,{value:o,children:o},o))})]}),i(B,{sx:{width:"20ch",p:{xs:2,md:3}},children:[e(z,{sx:{p:{xs:3,md:4}},children:"Late"}),e(F,{value:c.is_late,label:"Late",name:"is_late",onChange:d,children:r.map(o=>e(W,{value:o,children:o},o))})]}),i(B,{sx:{width:"20ch",p:{xs:2,md:3}},children:[e(z,{sx:{p:{xs:3,md:4}},children:"Sponsor"}),e(F,{value:c.is_sponsor,label:"Sponsor",name:"is_sponsor",onChange:d,children:r.map(o=>e(W,{value:o,children:o},o))})]}),i(B,{sx:{width:"20ch",p:{xs:2,md:3}},children:[e(z,{sx:{p:{xs:3,md:4}},children:"Active"}),e(F,{value:c.is_active,label:"Active",name:"is_active",onChange:d,children:r.map(o=>e(W,{value:o,children:o},o))})]}),i(B,{sx:{width:"20ch",p:{xs:2,md:3}},children:[e(z,{sx:{p:{xs:3,md:4}},children:"Staff"}),e(F,{value:c.is_staff,label:"Staff",name:"is_staff",onChange:d,children:r.map(o=>e(W,{value:o,children:o},o))})]}),i(B,{sx:{width:"20ch",p:{xs:2,md:3}},children:[e(z,{sx:{p:{xs:3,md:4}},children:"Admin"}),e(F,{value:c.is_admin,label:"Admin",name:"is_admin",onChange:d,children:r.map(o=>e(W,{value:o,children:o},o))})]}),i(B,{sx:{width:"20ch",p:{xs:2,md:3}},children:[e(z,{sx:{p:{xs:3,md:4}},children:"Accommodation"}),e(F,{value:c.has_accommodation,label:"Accommodation",name:"has_accommodation",onChange:d,children:r.map(o=>e(W,{value:o,children:o},o))})]}),i(B,{sx:{width:"20ch",p:{xs:2,md:3}},children:[e(z,{sx:{p:{xs:3,md:4}},children:"Checked In"}),e(F,{value:c.checked_in,label:"Checked In",name:"checked_in",onChange:d,children:r.map(o=>e(W,{value:o,children:o},o))})]}),e(Ue,{url:T+"auth/users.csv",filename:"users.csv",children:e(de,{"aria-label":"download",sx:{p:{xs:4,md:5}},children:e(Fe,{})})}),e(fe,{children:h.filter(o=>(f(o.full_name)||f(o.nickname)||f(o.email)||f(o.id+"")||f(o.badge_override))&&Y(o)).map((o,R)=>e(ne,{children:i(ce,{onClick:()=>L(o),children:[e(se,{children:o.badge_image?e(oe,{src:"https://storage.googleapis.com/reggie-badges/"+o.badge_image}):e(oe,{children:e(bt,{})})}),e(ae,{primary:o.nickname,secondary:o.full_name+" - "+o.email+" - #"+(o.badge_override?o.badge_override+" (Overridden from "+o.id+")":o.id)})]})},R))}),a?e(rn,{open:!0,handleClose:k,userId:a,handleDeleted:D}):null]})}function ln(t){const r=H(),[a,p]=u.exports.useState([]),[n,c]=u.exports.useState("");u.exports.useEffect(()=>{Me().then(h=>{h.status==200?h.json().then(_=>{p(_.results.filter(g=>g.min_capacity<=t.groupSize&&g.max_capacity>=t.groupSize)),c("0")}):h.status==401&&(r(A("/")),r(M()),localStorage.removeItem("TOKEN"))})},[]);const m=h=>{c(h.target.value)};return i(U,{open:t.open,onClose:()=>t.handleClose(null),children:[e($,{children:"Pick accommodation"}),a?i(E,{children:[e(N,{children:e(F,{value:n,label:"Accommodation",fullWidth:!0,variant:"standard",margin:"dense",onChange:m,children:a.map((h,_)=>e(W,{value:_,children:h.name},_))})}),i(J,{children:[e(v,{onClick:()=>t.handleClose(null),children:"Close"}),e(v,{onClick:()=>t.handleClose(a[parseInt(n)]),children:"Confirm"})]})]}):null]})}function cn(t){const r=H(),[a,p]=u.exports.useState(null),[n,c]=u.exports.useState(0),[m,h]=u.exports.useState(!1),[_,g]=u.exports.useState(""),[y,b]=u.exports.useState(!1),[D,L]=u.exports.useState(!1),[k,G]=u.exports.useState(!1);u.exports.useEffect(()=>{Se(t.groupId).then(C=>{C.status==200?C.json().then(l=>{p(l),g(l.internal_notes)}):C.status==401&&(r(A("/")),r(M()),localStorage.removeItem("TOKEN"))})},[]);const d=C=>{c(C)},f=()=>{c(0)},w=()=>{a&&(a.users=a.users.filter(C=>C.id!==n),le(a).then(C=>{C.status==200&&C.json().then(l=>{p(l),c(0)})}))},Y=()=>{h(!0)},o=()=>{h(!1)},R=()=>{a&&Qt(a).then(C=>{C.status==204&&(t.handleDeleted(a),r(A("/groups")))})},s=C=>{a&&tn(a,C).then(l=>{l.json().then(x=>p(x))})},O=C=>{a&&g(C.target.value)},Ce=()=>{a&&(a.internal_notes=_,le(a).then(C=>{C.status==200&&C.json().then(l=>{b(!0),p(l),g(l.internal_notes)})}))},X=C=>{if(C.claimed_at){const l=new Date(C.claimed_at);return Math.round(Math.abs((l.getTime()-new Date().getTime())/864e5))}return 0},ye=()=>{G(!0)},ie=()=>{G(!1)},_e=()=>{a&&(a.accommodation=null,le(a).then(C=>{C.status==200&&p(I({},a))}),ie())},me=()=>{L(!0)},ve=C=>{a&&C&&(a.accommodation=C,le(a).then(l=>{l.status==200&&p(q(I({},a),{accommodation:C}))})),L(!1)};return i(E,{children:[i(U,{open:t.open,onClose:t.handleClose,scroll:"body",children:[e($,{children:"Group"}),a?i(E,{children:[e(N,{children:i(j,{children:["Group ID: ",t.groupId]})}),e(N,{children:i(j,{sx:{"& button":{m:1}},children:["Owner:"," ",e(ge,{to:"/attendees/"+a.owner.id,children:a.owner.nickname+(a.owner.fully_paid?" (Paid)":" (Not paid)")}),e(v,{size:"small",variant:"contained",color:"error",onClick:Y,children:"Disband Group"})]})}),a.users.filter(C=>C.id!==a.owner.id).map((C,l)=>e(N,{children:i(j,{sx:{"& button":{m:1}},children:[e(ge,{to:"/attendees/"+C.id,children:C.nickname+(C.fully_paid?" (Paid)":" (Not paid)")}),e(v,{size:"small",variant:"contained",color:"error",onClick:()=>d(C.id),children:"Remove from group"}),e(v,{size:"small",variant:"contained",color:"primary",onClick:()=>s(C.id),children:"Make group owner"})]})},l)),e(N,{children:i(K,{children:[e(S,{multiline:!0,rows:4,name:"internal_notes",label:"Internal Notes",value:_||"",onChange:O,fullWidth:!0,variant:"standard",margin:"dense"}),e(v,{color:y?"success":"primary",onClick:Ce,children:y?"Saved!":"Save internal notes"})]})}),i(N,{children:[a.accommodation?i(j,{sx:{"& button":{m:1}},children:["Accommodation:"," ",e(ge,{to:"/accommodation/"+a.accommodation.id,children:a.accommodation.name}),e(v,{size:"small",variant:"contained",color:"error",onClick:ye,children:"Remove accommodation"}),e("br",{}),"Claimed ",X(a)," days ago"]}):i(j,{sx:{"& button":{m:1}},children:["No accommodation",e(v,{size:"small",variant:"contained",color:"primary",onClick:me,children:"Add accommodation"})]}),e(ln,{open:D,groupSize:a.users.length,handleClose:ve})]}),e(J,{children:e(v,{onClick:t.handleClose,children:"Close"})})]}):null]}),e(U,{open:k,onClose:ie,children:a?i(E,{children:[e($,{children:"Remove from group"}),e(N,{children:e(j,{children:"Are you sure?"})}),i(J,{children:[e(v,{onClick:ie,children:"Close"}),e(v,{onClick:_e,children:"Remove from group"})]})]}):null}),e(U,{open:!!n,onClose:f,children:a?i(E,{children:[e($,{children:"Remove from group"}),e(N,{children:e(j,{children:"Are you sure?"})}),i(J,{children:[e(v,{onClick:f,children:"Close"}),e(v,{onClick:w,children:"Remove from group"})]})]}):null}),e(U,{open:m,onClose:o,children:a?i(E,{children:[e($,{children:"Disband group"}),e(N,{children:e(j,{children:"Are you sure?"})}),i(J,{children:[e(v,{onClick:o,children:"Close"}),e(v,{onClick:R,children:"Disband group"})]})]}):null})]})}function je(){const t=H(),r=["Not Filtered","Yes","No"],{id:a}=ke(),[p,n]=u.exports.useState(""),[c,m]=u.exports.useState([]),[h,_]=u.exports.useState(""),[g,y]=u.exports.useState({has_accommodation:"Yes",paid:"Not Filtered"});u.exports.useEffect(()=>{He().then(s=>{s.status==200?s.json().then(O=>{console.log(O),m(O.results)}):s.status==401?(t(A("/")),t(M()),localStorage.removeItem("TOKEN")):s.json().then(O=>{n("Error while retrieving groups.  Please try again or contact tech."),console.log(O)})})},[]);const b=s=>{t(A("/groups/"+s.id))},D=()=>{t(A("/groups"))},L=s=>{_(s.target.value)},k=s=>s.accommodation&&s.accommodation.name.toLowerCase().includes(h.toLowerCase())||s.owner.nickname.toLowerCase().includes(h.toLowerCase()),G=s=>{for(const O of s.users)if(!O.fully_paid)return!0;return!1},d=s=>{m(c.filter(O=>s.id!==O.id))},f=s=>{if(s.claimed_at){const O=new Date(s.claimed_at);return Math.round(Math.abs((O.getTime()-new Date().getTime())/864e5))}return 0},w=s=>s.accommodation?G(s)?" (Unpaid for "+f(s)+" days)":" (Paid)":"",Y=s=>{console.log(s.target.name+": "+s.target.value),g[s.target.name]=s.target.value,y(I({},g))},o=(s,O)=>s==r[0]?!0:s==r[1]?O:!O,R=s=>o(g.has_accommodation,s.accommodation!=null)&&o(g.paid,!G(s));return i(E,{children:[p?e(he,{severity:"error",children:p}):null,e(S,{fullWidth:!0,id:"outlined-basic",label:"Search",variant:"outlined",onChange:L}),i(B,{sx:{width:"20ch",p:{xs:2,md:3}},children:[e(z,{sx:{p:{xs:3,md:4}},children:"Accommodation"}),e(F,{value:g.has_accommodation,label:"Accommodation",name:"has_accommodation",onChange:Y,children:r.map(s=>e(W,{value:s,children:s},s))})]}),i(B,{sx:{width:"20ch",p:{xs:2,md:3}},children:[e(z,{sx:{p:{xs:3,md:4}},children:"Paid"}),e(F,{value:g.paid,label:"Paid",name:"paid",onChange:Y,children:r.map(s=>e(W,{value:s,children:s},s))})]}),e(Ue,{url:T+"groups.csv",filename:"groups.csv",children:e(de,{"aria-label":"download",sx:{p:{xs:4,md:5}},children:e(Fe,{})})}),e(fe,{children:c.filter(s=>k(s)&&R(s)).map((s,O)=>e(ne,{children:i(ce,{onClick:()=>b(s),children:[e(se,{children:e(oe,{children:e(Ge,{})})}),e(ae,{primary:s.owner.nickname+"'s group",secondary:s.users.length+" member(s)"+w(s)})]})},O))}),a?e(cn,{open:!0,handleClose:D,groupId:a,handleDeleted:d}):null]})}function sn(){const t=H(),[r,a]=u.exports.useState(""),[p,n]=u.exports.useState([]),[c,m]=u.exports.useState(-1);u.exports.useEffect(()=>{Be().then(y=>{y.status==200?y.json().then(b=>{n(b.results)}):y.status==401?(t(A("/")),t(M()),localStorage.removeItem("TOKEN")):y.json().then(b=>{a("Error while retrieving config.  Please try again or contact tech."),console.log(b)})})},[]);const h=y=>{p[parseInt(y.target.name)].value=y.target.value,n([...p])},_=y=>{nn(p[y]).then(b=>{b.status==200?m(y):b.json().then(D=>{a("Error while retrieving config.  Please try again or contact tech."),console.log(D)})})},g={SIGNUP_MODE:"Current signup page restriction.  Set to 0 for signup closed, 1 for staff-only and 2 for signup open.",RECAPTCHA_MIN_SCORE:"Minimum required ReCAPTCHA assessment score, 0 is fail, 1 is success.  If in doubt, set to 0.3",INTRO_TEXT:"Message displayed on the registration site homepage.",CLAIM_MODE:"Current accommodation claim restriction.  Set to 0 for claim unavailable, 1 for staff-only and 2 for open to all.",SPONSOR_PRICE:"The price to sponsor in pence.",STAFF_DISCOUNT:"The discount staff receive in pence.",LODGE_EXTRA_DAYS:"The price in pence for extra days for lodges as JSON array of 8 prices.  Enter just null for no price.",EXTRA_DAYS:"The price in pence for extra days as JSON array of 8 prices.  Enter just null for no price.",REGISTRATION_EDITS:"Allow users to edit their details.  Set to 0 prevent any changes, 1 to allow changes.",ALLOW_PAYMENTS:"Allow users to make payments.  Set to 0 prevent any payments, 1 to allow payments.",HOODIE_SIZES:"The sizes of hoodie available in a JSON array."};return i(K,{direction:"column",spacing:2,children:[r?e(he,{severity:"error",children:r}):null,p.map((y,b)=>i(K,{direction:"row",alignItems:"center",spacing:2,children:[e(re,{children:y.id}),e(S,{name:""+b,label:"Value",multiline:!0,maxRows:4,value:y.value,onChange:h}),e(re,{width:400,children:g[y.id]}),e(v,{variant:"contained",color:c==b?"success":"primary",onClick:()=>_(b),children:c==b?"Saved!":"Save"})]},b))]})}function dn(t){const r=H(),[a,p]=u.exports.useState(!1),[n,c]=u.exports.useState(),m=We.createRef();u.exports.useEffect(()=>{t.isNew?c({id:crypto.randomUUID(),name:"",min_capacity:1,max_capacity:2,availability:0,prices:[null,null,null,null,null,null,null,null],is_lodge:!1,internal_notes:""}):Yt(t.accommodationId).then(d=>{d.status==200?d.json().then(f=>{c(f)}):d.status==401&&(r(A("/")),r(M()),localStorage.removeItem("TOKEN"))})},[]);const h=d=>{n&&c(q(I({},n),{[d.target.name]:d.target.value}))},_=d=>{if(n){const f=[...n.prices];for(let w=0;w<8;w++)(w+1<n.min_capacity||w+1>n.max_capacity)&&(f[w]=null);c(q(I({},n),{prices:f,[d.target.name]:d.target.value}))}},g=d=>{n&&c(q(I({},n),{[d.target.name]:d.target.checked}))},y=d=>{if(n){const f=parseInt(d.target.name.substring(d.target.name.indexOf("_")+1)),w=[...n.prices];w[f-1]=parseInt(d.target.value),c(q(I({},n),{prices:w}))}},b=()=>{p(!0)},D=()=>{p(!1)},L=()=>{n&&Xt(n).then(d=>{d.status==204&&(t.handleDeleted(n),r(A("/accommodation")))})},k=()=>{n&&m.current&&m.current.reportValidity()&&(t.isNew?Vt(n):Zt(n)).then(f=>{(f.status==200||f.status==201)&&(t.handleUpdated(),r(A("/accommodation")))})},G=()=>{n&&n.id&&navigator.clipboard.writeText(n.id)};return i(E,{children:[i(U,{open:t.open,onClose:t.handleClose,scroll:"body",children:[i(K,{direction:"row",alignItems:"center",minWidth:"558px",children:[i($,{children:[t.isNew?"Create ":null,"Accommodation"]}),n&&!t.isNew?i(j,{children:["ID: ",n.id,e(xt,{title:"Copy",children:e(de,{"aria-label":"copy",onClick:G,children:e(St,{})})})]}):null]}),n?i(E,{children:[e(N,{children:i(K,{component:"form",ref:m,spacing:2,children:[e(S,{name:"name",onChange:h,label:"Accommodation Name",value:n.name,required:!0}),e(ee,{control:e(te,{name:"is_lodge",checked:n.is_lodge,onChange:g}),label:"Is lodge?"}),i(K,{direction:"row",spacing:2,alignItems:"center",justifyContent:"left",children:[e(S,{fullWidth:!0,required:!0,name:"min_capacity",onChange:_,label:"Minimum Occupancy",type:"number",inputProps:{inputMode:"numeric",pattern:"[0-9]*",min:1,max:8},value:n.min_capacity}),e(S,{fullWidth:!0,required:!0,name:"max_capacity",onChange:_,label:"Maximum Occupancy",type:"number",inputProps:{inputMode:"numeric",pattern:"[0-9]*",min:1,max:8},value:n.max_capacity}),e(S,{fullWidth:!0,required:!0,name:"availability",onChange:h,label:"Availability",type:"number",inputProps:{inputMode:"numeric",pattern:"[0-9]*"},value:n.availability})]}),e(K,{direction:"row",children:e(Ee,{container:!0,spacing:2,children:n.prices.map((d,f)=>f+1>=(n.min_capacity||1)&&f+1<=(n.max_capacity||8)&&f+1>=1&&f+1<=8?e(Ee,{item:!0,xs:6,children:e(S,{fullWidth:!0,required:!0,label:"Price for "+(f+1),name:"price_"+(f+1),value:d||"",onChange:y,type:"number",InputProps:{endAdornment:e(xe,{position:"end",children:"p"})}})},f):null)})}),e(S,{fullWidth:!0,name:"internal_notes",onChange:h,label:"Internal Notes",value:n.internal_notes,multiline:!0})]})}),i(J,{children:[t.isNew?e(E,{children:e(v,{onClick:k,children:"Create"})}):i(E,{children:[e(v,{onClick:k,children:"Save"}),e(v,{color:"error",onClick:b,children:"Delete"})]}),e(v,{onClick:t.handleClose,children:"Close"})]})]}):null]}),e(U,{open:a,onClose:D,children:n&&!t.isNew?i(E,{children:[e($,{children:"Delete Accommodation"}),e(N,{children:e(j,{children:"Are you sure?"})}),i(J,{children:[e(v,{onClick:D,children:"Close"}),e(v,{onClick:L,children:"Delete"})]})]}):null})]})}function Le(){const t=H(),{id:r}=ke(),[a,p]=u.exports.useState(""),[n,c]=u.exports.useState([]),[m,h]=u.exports.useState("");u.exports.useEffect(()=>{_()},[]);const _=()=>{Me().then(d=>{d.status==200?d.json().then(f=>{c(f.results)}):d.status==401?(t(A("/")),t(M()),localStorage.removeItem("TOKEN")):d.json().then(f=>{p("Error while retrieving groups.  Please try again or contact tech."),console.log(f)})})},g=d=>{t(A("/accommodation/"+d.id))},y=()=>{t(A("/accommodation/new"))},b=()=>{t(A("/accommodation"))},D=d=>{h(d.target.value)},L=d=>d.toLowerCase().includes(m.toLowerCase()),k=d=>{c(n.filter(f=>d.id!==f.id))},G=()=>{_()};return i(E,{children:[a?e(he,{severity:"error",children:a}):null,e(S,{fullWidth:!0,id:"outlined-basic",label:"Search",variant:"outlined",onChange:D}),i(fe,{children:[e(ne,{children:i(ce,{onClick:()=>y(),children:[e(se,{children:e(oe,{children:e(Ne,{})})}),e(ae,{primary:"Create New"})]})}),n.filter(d=>L(d.name)).map((d,f)=>e(ne,{children:i(ce,{onClick:()=>g(d),children:[e(se,{children:e(oe,{children:e(be,{})})}),e(ae,{primary:d.name,secondary:i(K,{direction:"row",spacing:4,alignItems:"center",justifyContent:"left",children:[i(K,{direction:"row",spacing:1,alignItems:"center",children:[e(wt,{}),i("span",{children:[d.min_capacity,"-",d.max_capacity]})]}),i(K,{direction:"row",spacing:1,alignItems:"center",children:[e(be,{}),e("span",{children:d.availability+" ("+(d.availability-d.occupied)+" remaining)"})]})]})})]})},f)),e(ne,{children:i(ce,{onClick:()=>y(),children:[e(se,{children:e(oe,{children:e(Ne,{})})}),e(ae,{primary:"Create New"})]})})]}),r?e(dn,{open:!0,handleClose:b,accommodationId:r,handleDeleted:k,handleUpdated:G,isNew:r=="new"}):null]})}kt.render(e(We.StrictMode,{children:e(At,{store:Ae,children:e(Dt,{children:e(Tt,{history:Mt,children:i(Ot,{children:[e(V,{path:"/",element:e(an,{})}),e(V,{path:"/accommodation",element:e(Le,{})}),e(V,{path:"/accommodation/:id",element:e(Le,{})}),e(V,{path:"/attendees",element:e(Pe,{})}),e(V,{path:"/attendees/:id",element:e(Pe,{})}),e(V,{path:"/groups",element:e(je,{})}),e(V,{path:"/groups/:id",element:e(je,{})}),e(V,{path:"/config",element:e(sn,{})})]})})})})}),document.getElementById("root"));Be().then(t=>{t.status==200&&t.json().then(r=>{const a={};r.results.map(p=>{a[p.id]=p.value}),Ae.dispatch(Rt(a))})});

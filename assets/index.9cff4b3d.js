var Le=Object.defineProperty,Ke=Object.defineProperties;var Re=Object.getOwnPropertyDescriptors;var fe=Object.getOwnPropertySymbols;var We=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable;var Ce=(t,i,o)=>i in t?Le(t,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[i]=o,E=(t,i)=>{for(var o in i||(i={}))We.call(i,o)&&Ce(t,o,i[o]);if(fe)for(var o of fe(i))Me.call(i,o)&&Ce(t,o,i[o]);return t},z=(t,i)=>Ke(t,Re(i));import{u as ze,a as Fe,s as pe,M as He,c as qe,r as s,j as r,T as Be,b as e,C as $e,B as Ue,d as Je,I as de,e as Ve,f as Z,D as Xe,g as Ye,h as Qe,i as Ze,L as re,k as B,l as et,m as $,n as ye,o as ue,p as tt,q as Te,t as nt,v as _,w as ot,x as at,y as rt,z as it,F as x,A as te,P as lt,S as G,E as v,G as R,H as W,J as P,K as xe,N as Ae,O as M,Q as D,R as S,U as ct,V as st,W as dt,X as J,Y as V,Z as he,_ as ae,$ as ut,a0 as ge,a1 as Y,a2 as Q,a3 as U,a4 as ht,a5 as Ie,a6 as mt,a7 as pt,a8 as ve,a9 as be,aa as gt,ab as ft,ac as Ct,ad as yt,ae as vt,af as F}from"./vendor.5aebe429.js";const bt=function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))p(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const h of c.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&p(h)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerpolicy&&(c.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?c.credentials="include":n.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function p(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}};bt();const K=()=>ze(),Oe=Fe,ee=240,St=pe("main",{shouldForwardProp:t=>t!=="open"})(({theme:t,open:i})=>E({flexGrow:1,padding:t.spacing(3),transition:t.transitions.create("margin",{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen}),marginLeft:`-${ee}px`},i&&{transition:t.transitions.create("margin",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.enteringScreen}),marginLeft:0})),wt=pe(He,{shouldForwardProp:t=>t!=="open"})(({theme:t,open:i})=>E({transition:t.transitions.create(["margin","width"],{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen})},i&&{width:`calc(100% - ${ee}px)`,marginLeft:`${ee}px`,transition:t.transitions.create(["margin","width"],{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.enteringScreen})})),Se=pe("div")(({theme:t})=>z(E({display:"flex",alignItems:"center",padding:t.spacing(0,1)},t.mixins.toolbar),{justifyContent:"flex-end"}));function _t(t){const i=K(),o=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,p=qe({palette:{mode:o?"dark":"light"}}),[n,c]=s.exports.useState(!0),h=Oe(l=>l.user.authed),d=()=>{c(!0)},y=()=>{c(!1)};let C;h?C={"/":{label:"Intro",icon:e(ye,{})},"/accommodation":{label:"Accommodation",icon:e(ue,{})},"/attendees":{label:"Attendees",icon:e(tt,{})},"/groups":{label:"Groups",icon:e(Te,{})},"/config":{label:"Config",icon:e(nt,{})}}:C={"/":{label:"Intro",icon:e(ye,{})}};const g="/"+window.location.pathname.split("/")[1],[b,O]=s.exports.useState(C[g].label),k=l=>{const T=C[l];O(T.label),i(_(l))};return r(Be,{theme:p,children:[e($e,{}),r(Ue,{sx:{display:"flex"},children:[e(wt,{position:"fixed",open:n,children:r(Je,{children:[e(de,{color:"inherit","aria-label":"open drawer",onClick:d,edge:"start",sx:E({mr:2},n&&{display:"none"}),children:e(Ve,{})}),e(Z,{variant:"h6",noWrap:!0,component:"div",children:b})]})}),r(Xe,{sx:{width:ee,flexShrink:0,"& .MuiDrawer-paper":{width:ee,boxSizing:"border-box"}},variant:"persistent",anchor:"left",open:n,children:[e(Se,{children:e(de,{onClick:y,children:p.direction==="ltr"?e(Ye,{}):e(Qe,{})})}),e(Ze,{}),e(re,{children:Object.keys(C).map(l=>r(B,{button:!0,onClick:()=>k(l),children:[e(et,{children:C[l].icon}),e($,{primary:C[l].label})]},l))})]}),r(St,{open:n,children:[e(Se,{}),t.children]})]})]})}const kt={authed:!!localStorage.getItem("TOKEN")},Ee=ot({name:"user",initialState:kt,reducers:{login(t){t.authed=!0},logout(t){t.authed=!1}}}),{login:Tt,logout:L}=Ee.actions;var xt=Ee.reducer;const{createReduxHistory:At,routerMiddleware:It,routerReducer:Ot}=at({history:rt()}),Ne=it({reducer:{router:Ot,user:xt},middleware:[It]}),Et=At(Ne),A=window.location.hostname=="localhost"?"http://localhost:8000/":"https://api.reg.furcation.org.uk/",Nt=window.location.protocol+"//"+window.location.host;function Pt(){return fetch(A+"auth/o/keycloak/?"+new URLSearchParams({redirect_uri:Nt}),{method:"GET",credentials:"include"})}function Dt(t,i){return fetch(A+"auth/o/keycloak/",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({state:t,code:i})})}function jt(){return fetch(A+"auth/users/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Gt(t){return fetch(A+"auth/users/"+t,{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Lt(t){return fetch(A+"auth/users/"+t.id+"/",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify(t)})}function Pe(){return fetch(A+"accommodation/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Kt(t){return fetch(A+"accommodation/"+t+"/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Rt(t){return fetch(A+"accommodation/",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify(t)})}function Wt(t){return fetch(A+"accommodation/"+t.id+"/",{method:"DELETE",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Mt(t){return fetch(A+"accommodation/"+t.id+"/",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify(t)})}function De(){return fetch(A+"groups/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function me(t){return fetch(A+"groups/"+t+"/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function zt(t){return fetch(A+"groups/"+t.id+"/",{method:"DELETE",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Ft(t){return fetch(A+"auth/users/"+t.id+"/",{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Ht(t,i){return fetch(A+"groups/"+t.id+"/",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify({owner:{id:i,nickname:""}})})}function X(t){return fetch(A+"groups/"+t.id+"/",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify(t)})}function qt(){return fetch(A+"config/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Bt(t){return fetch(A+"config/"+t.id+"/",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify({value:t.value})})}function $t(){const t=K(),i=Oe(h=>h.user.authed),[o,p]=s.exports.useState("");return s.exports.useEffect(()=>{const h=new URLSearchParams(window.location.search),d=h.get("state"),y=h.get("code");!i&&d&&y&&Dt(d,y).then(C=>{C.status==201?C.json().then(g=>{localStorage.setItem("TOKEN",g.access),t(Tt())}):C.json().then(g=>{p("Login flow expired, please login again."),console.log(g)})})},[]),r(x,{children:[o?e(te,{severity:"error",children:o}):null,r(lt,{variant:"outlined",sx:{my:{xs:3,md:6},p:{xs:2,md:3}},children:[e(Z,{variant:"h6",color:"inherit",children:"Welcome to Furcation Registation Admin Panel"}),r(Z,{variant:"body1",color:"inherit",paragraph:!0,children:["Welcome to the admin panel here you can view and edit attendees and groups for maintainance or resolving issues. For any issues please contact us:",e("br",{}),e("br",{}),"Registration - reg@furcation.org.uk",e("br",{}),"IT - it@furcation.org.uk"]}),i?e(G,{spacing:2,alignItems:"center",children:e(v,{color:"error",variant:"contained",sx:{minWidth:{sm:400,xs:"100%"}},onClick:()=>{t(L()),localStorage.removeItem("TOKEN")},children:"Logout"})}):e(G,{spacing:2,alignItems:"center",children:e(v,{variant:"contained",sx:{minWidth:{sm:400,xs:"100%"}},onClick:()=>{Pt().then(h=>{h.status==200?h.json().then(d=>{window.location.href=d.authorization_url}):h.json().then(d=>{p("Error while contacting Keycloak, please try again or contact tech."),console.log(d)})})},children:"Login with Keycloak"})})]})]})}function Ut(t){const i=K(),[o,p]=s.exports.useState([]),[n,c]=s.exports.useState("");s.exports.useEffect(()=>{De().then(d=>{d.status==200?d.json().then(y=>{p(y.results.filter(C=>C.users.length<8)),c("0")}):d.status==401&&(i(_("/")),i(L()),localStorage.removeItem("TOKEN"))})},[]);const h=d=>{c(d.target.value)};return r(R,{open:t.open,onClose:()=>t.handleClose(null),children:[e(W,{children:"Pick a group"}),o?r(x,{children:[e(P,{children:e(xe,{value:n,label:"Group",fullWidth:!0,variant:"standard",margin:"dense",onChange:h,children:o.map((d,y)=>r(Ae,{value:y,children:[d.owner.nickname,"'s Group"]},y))})}),r(M,{children:[e(v,{onClick:()=>t.handleClose(null),children:"Close"}),e(v,{onClick:()=>t.handleClose(o[parseInt(n)]),children:"Confirm"})]})]}):null]})}function Jt(t){const i=K(),[o,p]=s.exports.useState({}),[n,c]=s.exports.useState(null),[h,d]=s.exports.useState(null),[y,C]=s.exports.useState("1990-01-01"),[g,b]=s.exports.useState(0),[O,k]=s.exports.useState(!1),[l,T]=s.exports.useState(!1);s.exports.useEffect(()=>{Gt(t.userId).then(m=>{m.status==200?m.json().then(w=>{c(w),C(w.date_of_birth),w.group&&me(w.group).then(I=>{I.status==200&&I.json().then(q=>{d(q)})})}):m.status==401?(i(_("/")),i(L()),localStorage.removeItem("TOKEN")):m.json().then(w=>{p(w),console.log(w)})})},[]);const a=m=>{n&&(n[m.target.name]=m.target.value,c(E({},n)))},u=()=>{T(!0)},j=()=>{n&&Ft(n).then(m=>{m.status==204&&(t.handleDeleted(n),t.handleClose())})},H=m=>{n&&(n[m.target.name]=m.target.checked,c(E({},n)))},ne=m=>{const w=new Date(m),I=w.getFullYear()+"-"+("0"+(w.getMonth()+1)).slice(-2)+"-"+("0"+w.getDate()).slice(-2);C(I),n&&(n.date_of_birth=I)},ie=()=>{if(n){b(1);const m=E({},n);m.phone_number=oe(m.phone_number),m.ice_phone=oe(m.ice_phone),delete m.group,Lt(m).then(w=>{console.log(w.status),w.status==200?w.json().then(I=>{b(2),c(I),C(I.date_of_birth),I.group&&me(I.group).then(q=>{q.status==200&&q.json().then(se=>{d(se)})})}):w.status==401?(i(_("/")),i(L()),localStorage.removeItem("TOKEN")):w.status==400&&(b(0),w.json().then(I=>{console.log(I),p(I)}))})}},oe=m=>(m=m.replaceAll(" ",""),m.charAt(0)==="0"?"+44"+m.substring(1):m),le=()=>{k(!0)},ce=m=>{n&&m&&(m.users.push({id:n.id,nickname:n.nickname,fully_paid:!1}),X(m).then(w=>{w.status==200&&(c(z(E({},n),{group:m})),d(m))})),k(!1)};return r(x,{children:[r(R,{open:t.open,onClose:t.handleClose,scroll:"body",children:[e(W,{children:"Attendee "}),n?r(x,{children:[r(P,{children:[r(D,{children:["Badge Number:"," ",n.badge_override?n.badge_override+" (Overridden from "+n.id+")":n.id]}),e(S,{required:!0,name:"full_name",label:"Full (Legal) Name",value:n.full_name,onChange:a,autoComplete:"fullname",error:Object.prototype.hasOwnProperty.call(o,"full_name"),helperText:o.full_name,fullWidth:!0,variant:"standard",margin:"dense"}),e(S,{required:!0,name:"nickname",label:"Badge Name (Nickname/Furry Name)",value:n.nickname,onChange:a,autoComplete:"nickname",error:Object.prototype.hasOwnProperty.call(o,"nickname"),helperText:o.nickname,fullWidth:!0,variant:"standard",margin:"dense"}),e(S,{required:!0,name:"email",label:"Email",value:n.email,onChange:a,autoComplete:"email",error:Object.prototype.hasOwnProperty.call(o,"email"),helperText:o.email,fullWidth:!0,variant:"standard",margin:"dense"}),e(ct,{dateAdapter:st,children:e(dt,{label:"Date of Birth",value:y,onChange:ne,inputFormat:"yyyy-MM-dd",mask:"____-__-__",renderInput:m=>e(S,z(E({},m),{required:!0,error:Object.prototype.hasOwnProperty.call(o,"date_of_birth"),helperText:o.date_of_birth,fullWidth:!0,variant:"standard",margin:"dense"}))})}),e(S,{required:!0,multiline:!0,rows:4,name:"address",label:"Address",value:n.address,onChange:a,error:Object.prototype.hasOwnProperty.call(o,"address"),helperText:o.address,fullWidth:!0,variant:"standard",margin:"dense"}),e(S,{required:!0,type:"tel",name:"phone_number",label:"Phone Number",autoComplete:"phone",value:n.phone_number,onChange:a,error:Object.prototype.hasOwnProperty.call(o,"phone_number"),helperText:o.phone_number,fullWidth:!0,variant:"standard",margin:"dense"}),e(S,{multiline:!0,rows:4,name:"medical_details",label:"Any medical details we should know? (optional)",value:n.medical_details||"",onChange:a,error:Object.prototype.hasOwnProperty.call(o,"medical_details"),helperText:o.medical_details,fullWidth:!0,variant:"standard",margin:"dense"}),e(S,{required:!0,name:"ice_name",label:"ICE Name",value:n.ice_name,onChange:a,autoComplete:"ice_name",error:Object.prototype.hasOwnProperty.call(o,"ice_name"),helperText:o.ice_name,fullWidth:!0,variant:"standard",margin:"dense"}),e(S,{required:!0,name:"ice_phone",label:"ICE Phone",value:n.ice_phone,onChange:a,autoComplete:"ice_phone",error:Object.prototype.hasOwnProperty.call(o,"ice_phone"),helperText:o.ice_phone,fullWidth:!0,variant:"standard",margin:"dense"}),e(J,{control:e(V,{name:"is_fursuiter",checked:n.is_fursuiter,onChange:H}),label:"Fursuiter"}),e(J,{control:e(V,{name:"is_early",checked:n.is_early,onChange:H}),label:"Early"}),e(J,{control:e(V,{name:"is_late",checked:n.is_late,onChange:H}),label:"Late"}),e(J,{control:e(V,{name:"is_sponsor",checked:n.is_sponsor,onChange:H}),label:"Sponsor"}),e(S,{name:"badge_override",label:"Badge Number Override",value:n.badge_override,onChange:a,autoComplete:"badge_override",error:Object.prototype.hasOwnProperty.call(o,"badge_override"),helperText:o.badge_override,fullWidth:!0,variant:"standard",margin:"dense"}),e(S,{name:"paid",label:"Amount paid",value:n.paid,onChange:a,autoComplete:"paid",type:"number",error:Object.prototype.hasOwnProperty.call(o,"paid"),InputProps:{endAdornment:e(he,{position:"end",children:"p"})},helperText:o.paid,fullWidth:!0,variant:"standard",margin:"dense"}),e(S,{name:"adjustments",label:"Bill adjustments",value:n.adjustments,onChange:a,autoComplete:"adjustments",type:"number",error:Object.prototype.hasOwnProperty.call(o,"adjustments"),InputProps:{endAdornment:e(he,{position:"end",children:"p"})},helperText:o.adjustments,fullWidth:!0,variant:"standard",margin:"dense"}),e(S,{multiline:!0,rows:4,name:"internal_notes",label:"Internal Notes",value:n.internal_notes||"",onChange:a,error:Object.prototype.hasOwnProperty.call(o,"internal_notes"),helperText:o.internal_notes,fullWidth:!0,variant:"standard",margin:"dense"})]}),e(P,{children:h?r(D,{children:["Group:"," ",r(ae,{to:"/groups/"+h.id,children:[h.owner.nickname,"'s Group"]})]}):r(D,{sx:{"& button":{m:1}},children:["No group",e(v,{size:"small",variant:"contained",color:"primary",onClick:le,children:"Add to a group"})]})}),r(M,{children:[e(v,{onClick:t.handleClose,children:"Close"}),e(v,{color:"error",onClick:u,children:"Delete"}),e(ut,{loading:g==1,color:g==2?"success":"primary",onClick:ie,children:g==2?"Saved!":"Save Changes"})]})]}):null]}),O?e(Ut,{open:!0,handleClose:ce}):null,r(R,{open:l,onClose:t.handleClose,children:[e(W,{children:"Delete Attendee"}),e(P,{children:e(D,{children:"Are you sure you want to delete this attendee?"})}),r(M,{children:[e(v,{onClick:t.handleClose,children:"Cancel"}),e(v,{onClick:j,color:"error",variant:"contained",children:"Delete"})]})]})]})}function we(){const t=K(),{id:i}=ge(),[o,p]=s.exports.useState(""),[n,c]=s.exports.useState([]),[h,d]=s.exports.useState("");s.exports.useEffect(()=>{y()},[]);const y=()=>{jt().then(l=>{l.status==200?l.json().then(T=>{c(T.results)}):l.status==401?(t(_("/")),t(L()),localStorage.removeItem("TOKEN")):l.json().then(T=>{p("Error while retrieving attendees.  Please try again or contact tech."),console.log(T)})})},C=l=>{c(n.filter(()=>l.id!==l.id))},g=l=>{t(_("/attendees/"+l.id))},b=()=>{t(_("/attendees")),y()},O=l=>{d(l.target.value)},k=l=>l.toLowerCase().includes(h.toLowerCase());return r(x,{children:[o?e(te,{severity:"error",children:o}):null,e(S,{fullWidth:!0,id:"outlined-basic",label:"Search",variant:"outlined",onChange:O}),e(re,{children:n.filter(l=>l.email?k(l.full_name)||k(l.nickname)||k(l.email)||k(l.id+"")||k(l.badge_override):!1).map((l,T)=>e(B,{children:r(Y,{onClick:()=>g(l),children:[e(Q,{children:l.badge_image?e(U,{src:"https://storage.googleapis.com/reggie-badges/"+l.badge_image}):e(U,{children:e(ht,{})})}),e($,{primary:l.nickname,secondary:l.full_name+" - "+l.email+" - #"+(l.badge_override?l.badge_override+" (Overridden from "+l.id+")":l.id)})]})},T))}),i?e(Jt,{open:!0,handleClose:b,userId:i,handleDeleted:C}):null]})}function Vt(t){const i=K(),[o,p]=s.exports.useState([]),[n,c]=s.exports.useState("");s.exports.useEffect(()=>{Pe().then(d=>{d.status==200?d.json().then(y=>{p(y.results.filter(C=>C.min_capacity<=t.groupSize&&C.max_capacity>=t.groupSize)),c("0")}):d.status==401&&(i(_("/")),i(L()),localStorage.removeItem("TOKEN"))})},[]);const h=d=>{c(d.target.value)};return r(R,{open:t.open,onClose:()=>t.handleClose(null),children:[e(W,{children:"Pick accommodation"}),o?r(x,{children:[e(P,{children:e(xe,{value:n,label:"Accommodation",fullWidth:!0,variant:"standard",margin:"dense",onChange:h,children:o.map((d,y)=>e(Ae,{value:y,children:d.name},y))})}),r(M,{children:[e(v,{onClick:()=>t.handleClose(null),children:"Close"}),e(v,{onClick:()=>t.handleClose(o[parseInt(n)]),children:"Confirm"})]})]}):null]})}function Xt(t){const i=K(),[o,p]=s.exports.useState(null),[n,c]=s.exports.useState(0),[h,d]=s.exports.useState(!1),[y,C]=s.exports.useState(""),[g,b]=s.exports.useState(!1),[O,k]=s.exports.useState(!1),[l,T]=s.exports.useState(!1);s.exports.useEffect(()=>{me(t.groupId).then(f=>{f.status==200?f.json().then(N=>{p(N),C(N.internal_notes)}):f.status==401&&(i(_("/")),i(L()),localStorage.removeItem("TOKEN"))})},[]);const a=f=>{c(f)},u=()=>{c(0)},j=()=>{o&&(o.users=o.users.filter(f=>f.id!==n),X(o).then(f=>{f.status==200&&f.json().then(N=>{p(N),c(0)})}))},H=()=>{d(!0)},ne=()=>{d(!1)},ie=()=>{o&&zt(o).then(f=>{f.status==204&&(t.handleDeleted(o),i(_("/groups")))})},oe=f=>{o&&Ht(o,f).then(N=>{N.json().then(Ge=>p(Ge))})},le=f=>{o&&C(f.target.value)},ce=()=>{o&&(o.internal_notes=y,X(o).then(f=>{f.status==200&&f.json().then(N=>{b(!0),p(N),C(N.internal_notes)})}))},m=f=>{if(f.claimed_at){const N=new Date(f.claimed_at);return Math.round(Math.abs((N.getTime()-new Date().getTime())/864e5))}return 0},w=()=>{T(!0)},I=()=>{T(!1)},q=()=>{o&&(o.accommodation=null,X(o).then(f=>{f.status==200&&p(E({},o))}),I())},se=()=>{k(!0)},je=f=>{o&&f&&(o.accommodation=f,X(o).then(N=>{N.status==200&&p(z(E({},o),{accommodation:f}))})),k(!1)};return r(x,{children:[r(R,{open:t.open,onClose:t.handleClose,scroll:"body",children:[e(W,{children:"Group"}),o?r(x,{children:[e(P,{children:r(D,{children:["Group ID: ",t.groupId]})}),e(P,{children:r(D,{sx:{"& button":{m:1}},children:["Owner:"," ",e(ae,{to:"/attendees/"+o.owner.id,children:o.owner.nickname+(o.owner.fully_paid?" (Paid)":" (Not paid)")}),e(v,{size:"small",variant:"contained",color:"error",onClick:H,children:"Disband Group"})]})}),o.users.filter(f=>f.id!==o.owner.id).map((f,N)=>e(P,{children:r(D,{sx:{"& button":{m:1}},children:[e(ae,{to:"/attendees/"+f.id,children:f.nickname+(f.fully_paid?" (Paid)":" (Not paid)")}),e(v,{size:"small",variant:"contained",color:"error",onClick:()=>a(f.id),children:"Remove from group"}),e(v,{size:"small",variant:"contained",color:"primary",onClick:()=>oe(f.id),children:"Make group owner"})]})},N)),e(P,{children:r(G,{children:[e(S,{multiline:!0,rows:4,name:"internal_notes",label:"Internal Notes",value:y||"",onChange:le,fullWidth:!0,variant:"standard",margin:"dense"}),e(v,{color:g?"success":"primary",onClick:ce,children:g?"Saved!":"Save internal notes"})]})}),r(P,{children:[o.accommodation?r(D,{sx:{"& button":{m:1}},children:["Accommodation:"," ",e(ae,{to:"/accommodation/"+o.accommodation.id,children:o.accommodation.name}),e(v,{size:"small",variant:"contained",color:"error",onClick:w,children:"Remove accommodation"}),e("br",{}),"Claimed ",m(o)," days ago"]}):r(D,{sx:{"& button":{m:1}},children:["No accommodation",e(v,{size:"small",variant:"contained",color:"primary",onClick:se,children:"Add accommodation"})]}),e(Vt,{open:O,groupSize:o.users.length,handleClose:je})]}),e(M,{children:e(v,{onClick:t.handleClose,children:"Close"})})]}):null]}),e(R,{open:l,onClose:I,children:o?r(x,{children:[e(W,{children:"Remove from group"}),e(P,{children:e(D,{children:"Are you sure?"})}),r(M,{children:[e(v,{onClick:I,children:"Close"}),e(v,{onClick:q,children:"Remove from group"})]})]}):null}),e(R,{open:!!n,onClose:u,children:o?r(x,{children:[e(W,{children:"Remove from group"}),e(P,{children:e(D,{children:"Are you sure?"})}),r(M,{children:[e(v,{onClick:u,children:"Close"}),e(v,{onClick:j,children:"Remove from group"})]})]}):null}),e(R,{open:h,onClose:ne,children:o?r(x,{children:[e(W,{children:"Disband group"}),e(P,{children:e(D,{children:"Are you sure?"})}),r(M,{children:[e(v,{onClick:ne,children:"Close"}),e(v,{onClick:ie,children:"Disband group"})]})]}):null})]})}function _e(){const t=K(),{id:i}=ge(),[o,p]=s.exports.useState(""),[n,c]=s.exports.useState([]),[h,d]=s.exports.useState("");s.exports.useEffect(()=>{De().then(a=>{a.status==200?a.json().then(u=>{console.log(u),c(u.results)}):a.status==401?(t(_("/")),t(L()),localStorage.removeItem("TOKEN")):a.json().then(u=>{p("Error while retrieving groups.  Please try again or contact tech."),console.log(u)})})},[]);const y=a=>{t(_("/groups/"+a.id))},C=()=>{t(_("/groups"))},g=a=>{d(a.target.value)},b=a=>a.accommodation&&a.accommodation.name.toLowerCase().includes(h.toLowerCase())||a.owner.nickname.toLowerCase().includes(h.toLowerCase()),O=a=>{for(const u of a.users)if(!u.fully_paid)return!0;return!1},k=a=>{c(n.filter(u=>a.id!==u.id))},l=a=>{if(a.claimed_at){const u=new Date(a.claimed_at);return Math.round(Math.abs((u.getTime()-new Date().getTime())/864e5))}return 0},T=a=>a.accommodation?O(a)?" (Unpaid for "+l(a)+" days)":" (Paid)":"";return r(x,{children:[o?e(te,{severity:"error",children:o}):null,e(S,{fullWidth:!0,id:"outlined-basic",label:"Search",variant:"outlined",onChange:g}),e(re,{children:n.filter(a=>b(a)).map((a,u)=>e(B,{children:r(Y,{onClick:()=>y(a),children:[e(Q,{children:e(U,{children:e(Te,{})})}),e($,{primary:a.owner.nickname+"'s group",secondary:a.users.length+" member(s)"+T(a)})]})},u))}),i?e(Xt,{open:!0,handleClose:C,groupId:i,handleDeleted:k}):null]})}function Yt(){const t=K(),[i,o]=s.exports.useState(""),[p,n]=s.exports.useState([]),[c,h]=s.exports.useState(-1);s.exports.useEffect(()=>{qt().then(g=>{g.status==200?g.json().then(b=>{n(b.results)}):g.status==401?(t(_("/")),t(L()),localStorage.removeItem("TOKEN")):g.json().then(b=>{o("Error while retrieving config.  Please try again or contact tech."),console.log(b)})})},[]);const d=g=>{p[parseInt(g.target.name)].value=g.target.value,n([...p])},y=g=>{Bt(p[g]).then(b=>{b.status==200?h(g):b.json().then(O=>{o("Error while retrieving config.  Please try again or contact tech."),console.log(O)})})},C={SIGNUP_MODE:"Current signup page restriction.  Set to 0 for signup closed, 1 for staff-only and 2 for signup open.",RECAPTCHA_MIN_SCORE:"Minimum required ReCAPTCHA assessment score, 0 is fail, 1 is success.  If in doubt, set to 0.3",INTRO_TEXT:"Message displayed on the registration site homepage.",CLAIM_MODE:"Current accommodation claim restriction.  Set to 0 for claim unavailable, 1 for staff-only and 2 for open to all.",SPONSOR_PRICE:"The price to sponsor in pence.",STAFF_DISCOUNT:"The discount staff receive in pence.",LODGE_EXTRA_DAYS:"The price in pence for extra days for lodges as JSON array of 8 prices.  Enter just null for no price.",EXTRA_DAYS:"The price in pence for extra days as JSON array of 8 prices.  Enter just null for no price."};return r(G,{direction:"column",spacing:2,children:[i?e(te,{severity:"error",children:i}):null,p.map((g,b)=>r(G,{direction:"row",alignItems:"center",spacing:2,children:[e(Z,{children:g.id}),e(S,{name:""+b,label:"Value",multiline:!0,maxRows:4,value:g.value,onChange:d}),e(Z,{width:400,children:C[g.id]}),e(v,{variant:"contained",color:c==b?"success":"primary",onClick:()=>y(b),children:c==b?"Saved!":"Save"})]},b))]})}function Qt(t){const i=K(),[o,p]=s.exports.useState(!1),[n,c]=s.exports.useState(),h=Ie.createRef();s.exports.useEffect(()=>{t.isNew?c({id:crypto.randomUUID(),name:"",min_capacity:1,max_capacity:2,availability:0,prices:[null,null,null,null,null,null,null,null],is_lodge:!1,internal_notes:""}):Kt(t.accommodationId).then(a=>{a.status==200?a.json().then(u=>{c(u)}):a.status==401&&(i(_("/")),i(L()),localStorage.removeItem("TOKEN"))})},[]);const d=a=>{n&&c(z(E({},n),{[a.target.name]:a.target.value}))},y=a=>{if(n){const u=[...n.prices];for(let j=0;j<8;j++)(j+1<n.min_capacity||j+1>n.max_capacity)&&(u[j]=null);c(z(E({},n),{prices:u,[a.target.name]:a.target.value}))}},C=a=>{n&&c(z(E({},n),{[a.target.name]:a.target.checked}))},g=a=>{if(n){const u=parseInt(a.target.name.substring(a.target.name.indexOf("_")+1)),j=[...n.prices];j[u-1]=parseInt(a.target.value),c(z(E({},n),{prices:j}))}},b=()=>{p(!0)},O=()=>{p(!1)},k=()=>{n&&Wt(n).then(a=>{a.status==204&&(t.handleDeleted(n),i(_("/accommodation")))})},l=()=>{n&&h.current&&h.current.reportValidity()&&(t.isNew?Rt(n):Mt(n)).then(u=>{(u.status==200||u.status==201)&&(t.handleUpdated(),i(_("/accommodation")))})},T=()=>{n&&n.id&&navigator.clipboard.writeText(n.id)};return r(x,{children:[r(R,{open:t.open,onClose:t.handleClose,scroll:"body",children:[r(G,{direction:"row",alignItems:"center",minWidth:"558px",children:[r(W,{children:[t.isNew?"Create ":null,"Accommodation"]}),n&&!t.isNew?r(D,{children:["ID: ",n.id,e(mt,{title:"Copy",children:e(de,{"aria-label":"copy",onClick:T,children:e(pt,{})})})]}):null]}),n?r(x,{children:[e(P,{children:r(G,{component:"form",ref:h,spacing:2,children:[e(S,{name:"name",onChange:d,label:"Accommodation Name",value:n.name,required:!0}),e(J,{control:e(V,{name:"is_lodge",checked:n.is_lodge,onChange:C}),label:"Is lodge?"}),r(G,{direction:"row",spacing:2,alignItems:"center",justifyContent:"left",children:[e(S,{fullWidth:!0,required:!0,name:"min_capacity",onChange:y,label:"Minimum Occupancy",type:"number",inputProps:{inputMode:"numeric",pattern:"[0-9]*",min:1,max:8},value:n.min_capacity}),e(S,{fullWidth:!0,required:!0,name:"max_capacity",onChange:y,label:"Maximum Occupancy",type:"number",inputProps:{inputMode:"numeric",pattern:"[0-9]*",min:1,max:8},value:n.max_capacity}),e(S,{fullWidth:!0,required:!0,name:"availability",onChange:d,label:"Availability",type:"number",inputProps:{inputMode:"numeric",pattern:"[0-9]*"},value:n.availability})]}),e(G,{direction:"row",children:e(ve,{container:!0,spacing:2,children:n.prices.map((a,u)=>u+1>=(n.min_capacity||1)&&u+1<=(n.max_capacity||8)&&u+1>=1&&u+1<=8?e(ve,{item:!0,xs:6,children:e(S,{fullWidth:!0,required:!0,label:"Price for "+(u+1),name:"price_"+(u+1),value:a||"",onChange:g,type:"number",InputProps:{endAdornment:e(he,{position:"end",children:"p"})}})},u):null)})}),e(S,{fullWidth:!0,name:"internal_notes",onChange:d,label:"Internal Notes",value:n.internal_notes,multiline:!0})]})}),r(M,{children:[t.isNew?e(x,{children:e(v,{onClick:l,children:"Create"})}):r(x,{children:[e(v,{onClick:l,children:"Save"}),e(v,{color:"error",onClick:b,children:"Delete"})]}),e(v,{onClick:t.handleClose,children:"Close"})]})]}):null]}),e(R,{open:o,onClose:O,children:n&&!t.isNew?r(x,{children:[e(W,{children:"Delete Accommodation"}),e(P,{children:e(D,{children:"Are you sure?"})}),r(M,{children:[e(v,{onClick:O,children:"Close"}),e(v,{onClick:k,children:"Delete"})]})]}):null})]})}function ke(){const t=K(),{id:i}=ge(),[o,p]=s.exports.useState(""),[n,c]=s.exports.useState([]),[h,d]=s.exports.useState("");s.exports.useEffect(()=>{y()},[]);const y=()=>{Pe().then(a=>{a.status==200?a.json().then(u=>{c(u.results)}):a.status==401?(t(_("/")),t(L()),localStorage.removeItem("TOKEN")):a.json().then(u=>{p("Error while retrieving groups.  Please try again or contact tech."),console.log(u)})})},C=a=>{t(_("/accommodation/"+a.id))},g=()=>{t(_("/accommodation/new"))},b=()=>{t(_("/accommodation"))},O=a=>{d(a.target.value)},k=a=>a.toLowerCase().includes(h.toLowerCase()),l=a=>{c(n.filter(u=>a.id!==u.id))},T=()=>{y()};return r(x,{children:[o?e(te,{severity:"error",children:o}):null,e(S,{fullWidth:!0,id:"outlined-basic",label:"Search",variant:"outlined",onChange:O}),r(re,{children:[e(B,{children:r(Y,{onClick:()=>g(),children:[e(Q,{children:e(U,{children:e(be,{})})}),e($,{primary:"Create New"})]})}),n.filter(a=>k(a.name)).map((a,u)=>e(B,{children:r(Y,{onClick:()=>C(a),children:[e(Q,{children:e(U,{children:e(ue,{})})}),e($,{primary:a.name,secondary:r(G,{direction:"row",spacing:4,alignItems:"center",justifyContent:"left",children:[r(G,{direction:"row",spacing:1,alignItems:"center",children:[e(gt,{}),r("span",{children:[a.min_capacity,"-",a.max_capacity]})]}),r(G,{direction:"row",spacing:1,alignItems:"center",children:[e(ue,{}),e("span",{children:a.availability+" ("+(a.availability-a.occupied)+" remaining)"})]})]})})]})},u)),e(B,{children:r(Y,{onClick:()=>g(),children:[e(Q,{children:e(U,{children:e(be,{})})}),e($,{primary:"Create New"})]})})]}),i?e(Qt,{open:!0,handleClose:b,accommodationId:i,handleDeleted:l,handleUpdated:T,isNew:i=="new"}):null]})}ft.render(e(Ie.StrictMode,{children:e(Ct,{store:Ne,children:e(_t,{children:e(yt,{history:Et,children:r(vt,{children:[e(F,{path:"/",element:e($t,{})}),e(F,{path:"/accommodation",element:e(ke,{})}),e(F,{path:"/accommodation/:id",element:e(ke,{})}),e(F,{path:"/attendees",element:e(we,{})}),e(F,{path:"/attendees/:id",element:e(we,{})}),e(F,{path:"/groups",element:e(_e,{})}),e(F,{path:"/groups/:id",element:e(_e,{})}),e(F,{path:"/config",element:e(Yt,{})})]})})})})}),document.getElementById("root"));

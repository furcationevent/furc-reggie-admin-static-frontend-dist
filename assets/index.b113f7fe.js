var pe=Object.defineProperty,me=Object.defineProperties;var fe=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var Q=(t,a,r)=>a in t?pe(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,T=(t,a)=>{for(var r in a||(a={}))Ce.call(a,r)&&Q(t,r,a[r]);if(Y)for(var r of Y(a))ye.call(a,r)&&Q(t,r,a[r]);return t},M=(t,a)=>me(t,fe(a));import{u as be,a as ve,s as U,M as we,c as Se,r as d,j as s,T as ke,b as e,C as _e,B as xe,d as Te,I as Z,e as Oe,f as K,D as Ie,g as Ee,h as Pe,i as Ae,L as V,k as J,l as De,m as X,n as ee,o as Ne,p as ae,q as Ge,t as k,v as je,w as Le,x as Ke,y as Re,F as O,A as F,P as Me,S as H,z as w,E as G,G as j,H as E,J as ze,K as We,N as L,O as P,Q as S,R as Fe,U as Be,V as He,W as z,X as W,Y as q,Z as qe,_ as oe,$ as ie,a0 as se,a1 as $,a2 as $e,a3 as Ue,a4 as Ve,a5 as Je,a6 as Xe,a7 as Ye,a8 as N}from"./vendor.146f302d.js";const Qe=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))h(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const f of o.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&h(f)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function h(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}};Qe();const A=()=>be(),le=ve,R=240,Ze=U("main",{shouldForwardProp:t=>t!=="open"})(({theme:t,open:a})=>T({flexGrow:1,padding:t.spacing(3),transition:t.transitions.create("margin",{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen}),marginLeft:`-${R}px`},a&&{transition:t.transitions.create("margin",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.enteringScreen}),marginLeft:0})),et=U(we,{shouldForwardProp:t=>t!=="open"})(({theme:t,open:a})=>T({transition:t.transitions.create(["margin","width"],{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen})},a&&{width:`calc(100% - ${R}px)`,marginLeft:`${R}px`,transition:t.transitions.create(["margin","width"],{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.enteringScreen})})),te=U("div")(({theme:t})=>M(T({display:"flex",alignItems:"center",padding:t.spacing(0,1)},t.mixins.toolbar),{justifyContent:"flex-end"}));function tt(t){const a=A(),r=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,h=Se({palette:{mode:r?"dark":"light"}}),[n,o]=d.exports.useState(!0),f=le(b=>b.user.authed),p=()=>{o(!0)},y=()=>{o(!1)};let g;f?g={"/":{label:"Intro",icon:e(ee,{})},"/attendees":{label:"Attendees",icon:e(Ne,{})},"/groups":{label:"Groups",icon:e(ae,{})},"/config":{label:"Config",icon:e(Ge,{})}}:g={"/":{label:"Intro",icon:e(ee,{})}};const C="/"+window.location.pathname.split("/")[1],[u,i]=d.exports.useState(g[C].label),l=b=>{const m=g[b];i(m.label),a(k(b))};return s(ke,{theme:h,children:[e(_e,{}),s(xe,{sx:{display:"flex"},children:[e(et,{position:"fixed",open:n,children:s(Te,{children:[e(Z,{color:"inherit","aria-label":"open drawer",onClick:p,edge:"start",sx:T({mr:2},n&&{display:"none"}),children:e(Oe,{})}),e(K,{variant:"h6",noWrap:!0,component:"div",children:u})]})}),s(Ie,{sx:{width:R,flexShrink:0,"& .MuiDrawer-paper":{width:R,boxSizing:"border-box"}},variant:"persistent",anchor:"left",open:n,children:[e(te,{children:e(Z,{onClick:y,children:h.direction==="ltr"?e(Ee,{}):e(Pe,{})})}),e(Ae,{}),e(V,{children:Object.keys(g).map(b=>s(J,{button:!0,onClick:()=>l(b),children:[e(De,{children:g[b].icon}),e(X,{primary:g[b].label})]},b))})]}),s(Ze,{open:n,children:[e(te,{}),t.children]})]})]})}const nt={authed:!!localStorage.getItem("TOKEN")},ce=je({name:"user",initialState:nt,reducers:{login(t){t.authed=!0},logout(t){t.authed=!1}}}),{login:rt,logout:D}=ce.actions;var at=ce.reducer;const{createReduxHistory:ot,routerMiddleware:it,routerReducer:st}=Le({history:Ke()}),de=Re({reducer:{router:st,user:at},middleware:[it]}),lt=ot(de),_=window.location.hostname=="localhost"?"http://localhost:8000/":"https://api.reg.furcation.org.uk/",ct=window.location.protocol+"//"+window.location.host;function dt(){return fetch(_+"auth/o/keycloak/?"+new URLSearchParams({redirect_uri:ct}),{method:"GET",credentials:"include"})}function ut(t,a){return fetch(_+"auth/o/keycloak/",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({state:t,code:a})})}function ht(){return fetch(_+"auth/users/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function gt(t){return fetch(_+"auth/users/"+t,{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function pt(t){return fetch(_+"auth/users/"+t.id+"/",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify(t)})}function ue(){return fetch(_+"groups/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function mt(t){return fetch(_+"groups/"+t+"/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function ft(t){return fetch(_+"groups/"+t.id+"/",{method:"DELETE",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Ct(t,a){return fetch(_+"groups/"+t.id+"/",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify({owner:{id:a,nickname:""}})})}function he(t){return fetch(_+"groups/"+t.id+"/",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify(t)})}function yt(){return fetch(_+"config/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function bt(t){return fetch(_+"config/"+t.id+"/",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify({value:t.value})})}function vt(){const t=A(),a=le(o=>o.user.authed),[r,h]=d.exports.useState("");return d.exports.useEffect(()=>{const o=new URLSearchParams(window.location.search),f=o.get("state"),p=o.get("code");!a&&f&&p&&ut(f,p).then(y=>{y.status==201?y.json().then(g=>{localStorage.setItem("TOKEN",g.access),t(rt())}):y.json().then(g=>{h("Login flow expired, please login again."),console.log(g)})})},[]),s(O,{children:[r?e(F,{severity:"error",children:r}):null,s(Me,{variant:"outlined",sx:{my:{xs:3,md:6},p:{xs:2,md:3}},children:[e(K,{variant:"h6",color:"inherit",children:"Welcome to Furcation Registation Admin Panel"}),e(K,{variant:"body1",color:"inherit",paragraph:!0,children:'Mayonnaise, colloquially referred to as "mayo", is a thick, cold, and creamy sauce or dressing commonly used on sandwiches, hamburgers, composed salads, and French fries. It also forms the base for various other sauces, such as tartar sauce, fry sauce, remoulade, salsa golf, and rouille.'}),a?null:e(H,{spacing:2,alignItems:"center",children:e(w,{variant:"contained",sx:{minWidth:{sm:400,xs:"100%"}},onClick:()=>{dt().then(o=>{o.status==200?o.json().then(f=>{window.location.href=f.authorization_url}):o.json().then(f=>{h("Error while contacting Keycloak, please try again or contact tech."),console.log(f)})})},children:"Login with Keycloak"})})]})]})}function wt(t){const a=A(),[r,h]=d.exports.useState([]),[n,o]=d.exports.useState("");d.exports.useEffect(()=>{ue().then(p=>{p.status==200?p.json().then(y=>{h(y.results.filter(g=>g.users.length<8)),o("0")}):p.status==401&&(a(k("/")),a(D()),localStorage.removeItem("TOKEN"))})},[]);const f=p=>{o(p.target.value)};return s(G,{open:t.open,onClose:()=>t.handleClose(null),children:[e(j,{children:"Pick a group"}),r?s(O,{children:[e(E,{children:e(ze,{value:n,label:"Group",fullWidth:!0,variant:"standard",margin:"dense",onChange:f,children:r.map((p,y)=>s(We,{value:y,children:[p.owner.nickname,"'s Group"]},y))})}),s(L,{children:[e(w,{onClick:()=>t.handleClose(null),children:"Close"}),e(w,{onClick:()=>t.handleClose(r[parseInt(n)]),children:"Confirm"})]})]}):null]})}function St(t){const a=A(),[r,h]=d.exports.useState({}),[n,o]=d.exports.useState(null),[f,p]=d.exports.useState("1990-01-01"),[y,g]=d.exports.useState(0),[C,u]=d.exports.useState(!1);d.exports.useEffect(()=>{gt(t.userId).then(c=>{c.status==200?c.json().then(v=>{o(v),p(v.date_of_birth)}):c.status==401?(a(k("/")),a(D()),localStorage.removeItem("TOKEN")):c.json().then(v=>{h(v),console.log(v)})})},[]);const i=c=>{n&&(n[c.target.name]=c.target.value,o(T({},n)))},l=c=>{n&&(n[c.target.name]=c.target.checked,o(T({},n)))},b=c=>{const v=new Date(c),I=v.getFullYear()+"-"+("0"+(v.getMonth()+1)).slice(-2)+"-"+("0"+v.getDate()).slice(-2);p(I),n&&(n.date_of_birth=I)},m=()=>{if(n){g(1);const c=T({},n);c.phone_number=x(c.phone_number),c.ice_phone=x(c.ice_phone),delete c.group,pt(c).then(v=>{console.log(v.status),v.status==200?v.json().then(I=>{g(2),o(I),p(I.date_of_birth)}):v.status==401?(a(k("/")),a(D()),localStorage.removeItem("TOKEN")):v.status==400&&(g(0),v.json().then(I=>{console.log(I),h(I)}))})}},x=c=>(c=c.replaceAll(" ",""),c.charAt(0)==="0"?"+44"+c.substring(1):c),B=()=>{u(!0)},ge=c=>{n&&c&&(c.users.push({id:n.id,nickname:n.nickname}),he(c).then(v=>{v.status==200&&o(M(T({},n),{group:c}))})),u(!1)};return s(O,{children:[s(G,{open:t.open,onClose:t.handleClose,scroll:"body",children:[e(j,{children:"Attendee"}),n?s(O,{children:[s(E,{children:[s(P,{children:["Badge Number:"," ",n.badge_override?n.badge_override+" (Overridden from "+n.id+")":n.id]}),e(S,{required:!0,name:"full_name",label:"Full (Legal) Name",value:n.full_name,onChange:i,autoComplete:"fullname",error:Object.prototype.hasOwnProperty.call(r,"full_name"),helperText:r.full_name,fullWidth:!0,variant:"standard",margin:"dense"}),e(S,{required:!0,name:"nickname",label:"Badge Name (Nickname/Furry Name)",value:n.nickname,onChange:i,autoComplete:"nickname",error:Object.prototype.hasOwnProperty.call(r,"nickname"),helperText:r.nickname,fullWidth:!0,variant:"standard",margin:"dense"}),e(S,{required:!0,name:"email",label:"Email",value:n.email,onChange:i,autoComplete:"email",error:Object.prototype.hasOwnProperty.call(r,"email"),helperText:r.email,fullWidth:!0,variant:"standard",margin:"dense"}),e(Fe,{dateAdapter:Be,children:e(He,{label:"Date of Birth",value:f,onChange:b,inputFormat:"yyyy-MM-dd",mask:"____-__-__",renderInput:c=>e(S,M(T({},c),{required:!0,error:Object.prototype.hasOwnProperty.call(r,"date_of_birth"),helperText:r.date_of_birth,fullWidth:!0,variant:"standard",margin:"dense"}))})}),e(S,{required:!0,multiline:!0,rows:4,name:"address",label:"Address",value:n.address,onChange:i,error:Object.prototype.hasOwnProperty.call(r,"address"),helperText:r.address,fullWidth:!0,variant:"standard",margin:"dense"}),e(S,{required:!0,type:"tel",name:"phone_number",label:"Phone Number",autoComplete:"phone",value:n.phone_number,onChange:i,error:Object.prototype.hasOwnProperty.call(r,"phone_number"),helperText:r.phone_number,fullWidth:!0,variant:"standard",margin:"dense"}),e(S,{multiline:!0,rows:4,name:"medical_details",label:"Any medical details we should know? (optional)",value:n.medical_details||"",onChange:i,error:Object.prototype.hasOwnProperty.call(r,"medical_details"),helperText:r.medical_details,fullWidth:!0,variant:"standard",margin:"dense"}),e(S,{required:!0,name:"ice_name",label:"ICE Name",value:n.ice_name,onChange:i,autoComplete:"ice_name",error:Object.prototype.hasOwnProperty.call(r,"ice_name"),helperText:r.ice_name,fullWidth:!0,variant:"standard",margin:"dense"}),e(S,{required:!0,name:"ice_phone",label:"ICE Phone",value:n.ice_phone,onChange:i,autoComplete:"ice_phone",error:Object.prototype.hasOwnProperty.call(r,"ice_phone"),helperText:r.ice_phone,fullWidth:!0,variant:"standard",margin:"dense"}),e(z,{control:e(W,{name:"is_fursuiter",checked:n.is_fursuiter,onChange:l}),label:"Fursuiter"}),e(z,{control:e(W,{name:"is_early",checked:n.is_early,onChange:l}),label:"Early"}),e(z,{control:e(W,{name:"is_late",checked:n.is_late,onChange:l}),label:"Late"}),e(z,{control:e(W,{name:"is_sponsor",checked:n.is_sponsor,onChange:l}),label:"Sponsor"}),e(S,{name:"badge_override",label:"Badge Number Override",value:n.badge_override,onChange:i,autoComplete:"badge_override",error:Object.prototype.hasOwnProperty.call(r,"badge_override"),helperText:r.badge_override,fullWidth:!0,variant:"standard",margin:"dense"})]}),e(E,{children:n.group?s(P,{children:["Group:"," ",s(q,{to:"/groups/"+n.group.id,children:[n.group.owner.nickname,"'s Group"]})]}):s(P,{sx:{"& button":{m:1}},children:["No group",e(w,{size:"small",variant:"contained",color:"primary",onClick:B,children:"Add to a group"})]})}),s(L,{children:[e(w,{onClick:t.handleClose,children:"Close"}),e(qe,{loading:y==1,color:y==2?"success":"primary",onClick:m,children:y==2?"Saved!":"Save Changes"})]})]}):null]}),C?e(wt,{open:!0,handleClose:ge}):null]})}function ne(){const t=A(),{id:a}=oe(),[r,h]=d.exports.useState(""),[n,o]=d.exports.useState([]),[f,p]=d.exports.useState("");d.exports.useEffect(()=>{ht().then(i=>{i.status==200?i.json().then(l=>{o(l.results)}):i.status==401?(t(k("/")),t(D()),localStorage.removeItem("TOKEN")):i.json().then(l=>{h("Error while retrieving attendees.  Please try again or contact tech."),console.log(l)})})},[]);const y=i=>{t(k("/attendees/"+i.id))},g=()=>{t(k("/attendees"))},C=i=>{p(i.target.value)},u=i=>i.toLowerCase().includes(f.toLowerCase());return s(O,{children:[r?e(F,{severity:"error",children:r}):null,e(S,{fullWidth:!0,id:"outlined-basic",label:"Search",variant:"outlined",onChange:C}),e(V,{children:n.filter(i=>i.email?u(i.full_name)||u(i.nickname)||u(i.email)||u(i.id+"")||u(i.badge_override):!1).map((i,l)=>e(J,{children:s(ie,{onClick:()=>y(i),children:[e(se,{children:i.badge_image?e($,{src:"https://storage.googleapis.com/reggie-badges/"+i.badge_image}):e($,{children:e($e,{})})}),e(X,{primary:i.nickname,secondary:i.full_name+" - "+i.email})]})},l))}),a?e(St,{open:!0,handleClose:g,userId:a}):null]})}function kt(t){const a=A(),[r,h]=d.exports.useState(null),[n,o]=d.exports.useState(0),[f,p]=d.exports.useState(!1);d.exports.useEffect(()=>{mt(t.groupId).then(m=>{m.status==200?m.json().then(x=>{h(x)}):m.status==401&&(a(k("/")),a(D()),localStorage.removeItem("TOKEN"))})},[]);const y=m=>{o(m)},g=()=>{o(0)},C=()=>{r&&(r.users=r.users.filter(m=>m.id!==n),he(r).then(m=>{m.status==200&&m.json().then(x=>{h(x),o(0)})}))},u=()=>{p(!0)},i=()=>{p(!1)},l=()=>{r&&ft(r).then(m=>{m.status==204&&(t.handleDeleted(r),a(k("/groups")))})},b=m=>{r&&Ct(r,m).then(x=>{x.json().then(B=>h(B))})};return s(O,{children:[s(G,{open:t.open,onClose:t.handleClose,scroll:"body",children:[e(j,{children:"Group"}),r?s(O,{children:[e(E,{children:s(P,{children:["Group ID: ",t.groupId]})}),e(E,{children:s(P,{sx:{"& button":{m:1}},children:["Owner:"," ",e(q,{to:"/attendees/"+r.owner.id,children:r.owner.nickname}),e(w,{size:"small",variant:"contained",color:"error",onClick:u,children:"Disband Group"})]})}),r.users.filter(m=>m.id!==r.owner.id).map((m,x)=>e(E,{children:s(P,{sx:{"& button":{m:1}},children:[e(q,{to:"/attendees/"+m.id,children:m.nickname}),e(w,{size:"small",variant:"contained",color:"error",onClick:()=>y(m.id),children:"Remove from group"}),e(w,{size:"small",variant:"contained",color:"primary",onClick:()=>b(m.id),children:"Make group owner"})]})},x)),e(L,{children:e(w,{onClick:t.handleClose,children:"Close"})})]}):null]}),e(G,{open:!!n,onClose:g,children:r?s(O,{children:[e(j,{children:"Remove from group"}),e(E,{children:e(P,{children:"Are you sure?"})}),s(L,{children:[e(w,{onClick:g,children:"Close"}),e(w,{onClick:C,children:"Remove from group"})]})]}):null}),e(G,{open:f,onClose:i,children:r?s(O,{children:[e(j,{children:"Disband group"}),e(E,{children:e(P,{children:"Are you sure?"})}),s(L,{children:[e(w,{onClick:i,children:"Close"}),e(w,{onClick:l,children:"Disband group"})]})]}):null})]})}function re(){const t=A(),{id:a}=oe(),[r,h]=d.exports.useState(""),[n,o]=d.exports.useState([]),[f,p]=d.exports.useState("");d.exports.useEffect(()=>{ue().then(l=>{l.status==200?l.json().then(b=>{o(b.results)}):l.status==401?(t(k("/")),t(D()),localStorage.removeItem("TOKEN")):l.json().then(b=>{h("Error while retrieving groups.  Please try again or contact tech."),console.log(b)})})},[]);const y=l=>{t(k("/groups/"+l.id))},g=()=>{t(k("/groups"))},C=l=>{p(l.target.value)},u=l=>l.toLowerCase().includes(f.toLowerCase()),i=l=>{o(n.filter(b=>l.id!==b.id))};return s(O,{children:[r?e(F,{severity:"error",children:r}):null,e(S,{fullWidth:!0,id:"outlined-basic",label:"Search",variant:"outlined",onChange:C}),e(V,{children:n.filter(l=>u(l.owner.nickname)).map((l,b)=>e(J,{children:s(ie,{onClick:()=>y(l),children:[e(se,{children:e($,{children:e(ae,{})})}),e(X,{primary:l.owner.nickname+"'s group",secondary:l.users.length+" member(s)"})]})},b))}),a?e(kt,{open:!0,handleClose:g,groupId:a,handleDeleted:i}):null]})}function _t(){const t=A(),[a,r]=d.exports.useState(""),[h,n]=d.exports.useState([]),[o,f]=d.exports.useState(-1);d.exports.useEffect(()=>{yt().then(C=>{C.status==200?C.json().then(u=>{n(u.results)}):C.status==401?(t(k("/")),t(D()),localStorage.removeItem("TOKEN")):C.json().then(u=>{r("Error while retrieving config.  Please try again or contact tech."),console.log(u)})})},[]);const p=C=>{h[parseInt(C.target.name)].value=C.target.value,n([...h])},y=C=>{bt(h[C]).then(u=>{u.status==200?f(C):u.json().then(i=>{r("Error while retrieving config.  Please try again or contact tech."),console.log(i)})})},g={SIGNUP_MODE:"Current signup page restriction.  Set to 0 for signup closed, 1 for staff-only and 2 for signup open.",RECAPTCHA_MIN_SCORE:"Minimum required ReCAPTCHA assessment score, 0 is fail, 1 is success.  If in doubt, set to 0.3",INTRO_TEXT:"Message displayed on the registration site homepage."};return s(H,{direction:"column",spacing:2,children:[a?e(F,{severity:"error",children:a}):null,h.map((C,u)=>s(H,{direction:"row",alignItems:"center",spacing:2,children:[e(K,{children:C.id}),e(S,{name:""+u,label:"Value",multiline:!0,maxRows:4,value:C.value,onChange:p}),e(K,{width:400,children:g[C.id]}),e(w,{variant:"contained",color:o==u?"success":"primary",onClick:()=>y(u),children:o==u?"Saved!":"Save"})]},u))]})}Ue.render(e(Ve.StrictMode,{children:e(Je,{store:de,children:e(tt,{children:e(Xe,{history:lt,children:s(Ye,{children:[e(N,{path:"/",element:e(vt,{})}),e(N,{path:"/attendees",element:e(ne,{})}),e(N,{path:"/attendees/:id",element:e(ne,{})}),e(N,{path:"/groups",element:e(re,{})}),e(N,{path:"/groups/:id",element:e(re,{})}),e(N,{path:"/config",element:e(_t,{})})]})})})})}),document.getElementById("root"));
